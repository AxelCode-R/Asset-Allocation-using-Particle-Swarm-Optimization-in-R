<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Particle Swarm Optimization (PSO) | Asset Allocation using Particle Swarm Optimization in R</title>
  <meta name="description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.28.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Particle Swarm Optimization (PSO) | Asset Allocation using Particle Swarm Optimization in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="AxelCode-R/Master-Thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Particle Swarm Optimization (PSO) | Asset Allocation using Particle Swarm Optimization in R" />
  
  <meta name="twitter:description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Axel Roth" />


<meta name="date" content="2022-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="analytic-solver-for-quadratic-programming-problems.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="my_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Master Thesis Axel Roth</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="abstract.html"><a href="abstract.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html"><i class="fa fa-check"></i><b>1</b> Software information and usage</a>
<ul>
<li class="chapter" data-level="1.1" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#r-version-and-packages"><i class="fa fa-check"></i><b>1.1</b> R-Version and Packages</a></li>
<li class="chapter" data-level="1.2" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
<li class="chapter" data-level="1.3" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#r-functions"><i class="fa fa-check"></i><b>1.3</b> R-functions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="open-data-sources.html"><a href="open-data-sources.html"><i class="fa fa-check"></i><b>2</b> Open Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="open-data-sources.html"><a href="open-data-sources.html#r-functions-1"><i class="fa fa-check"></i><b>2.1</b> R-Functions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="open-data-sources.html"><a href="open-data-sources.html#get_yf"><i class="fa fa-check"></i><b>2.1.1</b> <code>get_yf()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="open-data-sources.html"><a href="open-data-sources.html#buffer"><i class="fa fa-check"></i><b>2.1.2</b> <code>buffer()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mathfundations.html"><a href="mathfundations.html"><i class="fa fa-check"></i><b>3</b> Mathematical Fundations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mathfundations.html"><a href="mathfundations.html#basic-operators"><i class="fa fa-check"></i><b>3.1</b> Basic Operators</a></li>
<li class="chapter" data-level="3.2" data-path="mathfundations.html"><a href="mathfundations.html#return-calculation"><i class="fa fa-check"></i><b>3.2</b> Return Calculation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mathfundations.html"><a href="mathfundations.html#simple-returns"><i class="fa fa-check"></i><b>3.2.1</b> Simple Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mathfundations.html"><a href="mathfundations.html#markowitz-modern-portfolio-theory-mpt"><i class="fa fa-check"></i><b>3.3</b> Markowitz Modern Portfolio Theory (MPT)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="mathfundations.html"><a href="mathfundations.html#assumptions-of-markowitz-portfolio-theory"><i class="fa fa-check"></i><b>3.3.1</b> Assumptions of Markowitz Portfolio Theory</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mathfundations.html"><a href="mathfundations.html#portfolio-math"><i class="fa fa-check"></i><b>3.4</b> Portfolio Math</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mathfundations.html"><a href="mathfundations.html#expected-returns"><i class="fa fa-check"></i><b>3.4.1</b> Expected Returns</a></li>
<li class="chapter" data-level="3.4.2" data-path="mathfundations.html"><a href="mathfundations.html#expected-portfolio-returns"><i class="fa fa-check"></i><b>3.4.2</b> Expected Portfolio Returns</a></li>
<li class="chapter" data-level="3.4.3" data-path="mathfundations.html"><a href="mathfundations.html#covariance"><i class="fa fa-check"></i><b>3.4.3</b> Covariance</a></li>
<li class="chapter" data-level="3.4.4" data-path="mathfundations.html"><a href="mathfundations.html#portvar"><i class="fa fa-check"></i><b>3.4.4</b> Portfolio Variance</a></li>
<li class="chapter" data-level="3.4.5" data-path="mathfundations.html"><a href="mathfundations.html#portfolioreturns"><i class="fa fa-check"></i><b>3.4.5</b> Portfolio Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="mathfundations.html"><a href="mathfundations.html#r-functions-2"><i class="fa fa-check"></i><b>3.5</b> R-Functions</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="mathfundations.html"><a href="mathfundations.html#pritoret"><i class="fa fa-check"></i><b>3.5.1</b> <code>pri_to_ret()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="mathfundations.html"><a href="mathfundations.html#ret_to_cumret"><i class="fa fa-check"></i><b>3.5.2</b> <code>ret_to_cumret()</code></a></li>
<li class="chapter" data-level="3.5.3" data-path="mathfundations.html"><a href="mathfundations.html#geomeanret"><i class="fa fa-check"></i><b>3.5.3</b> <code>ret_to_geomeanret()</code></a></li>
<li class="chapter" data-level="3.5.4" data-path="mathfundations.html"><a href="mathfundations.html#calc_portfolio_returns"><i class="fa fa-check"></i><b>3.5.4</b> <code>calc_portfolio_returns()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activ-vs-passiv-investing.html"><a href="activ-vs-passiv-investing.html"><i class="fa fa-check"></i><b>4</b> Activ vs Passiv Investing</a></li>
<li class="chapter" data-level="5" data-path="challenges.html"><a href="challenges.html"><i class="fa fa-check"></i><b>5</b> Challenges of Passiv Investing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="challenges.html"><a href="challenges.html#mean-variance-portfolio-mvp"><i class="fa fa-check"></i><b>5.1</b> Mean-Variance Portfolio (MVP)</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="challenges.html"><a href="challenges.html#mvp-objective"><i class="fa fa-check"></i><b>5.1.1</b> MVP Objective</a></li>
<li class="chapter" data-level="5.1.2" data-path="challenges.html"><a href="challenges.html#mvp-example"><i class="fa fa-check"></i><b>5.1.2</b> MVP example</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="challenges.html"><a href="challenges.html#index-tracking-portfolio-itp"><i class="fa fa-check"></i><b>5.2</b> Index-Tracking Portfolio (ITP)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="challenges.html"><a href="challenges.html#itp-with-tev-objective-itp-tev"><i class="fa fa-check"></i><b>5.2.1</b> ITP with TEV objective (ITP-TEV)</a></li>
<li class="chapter" data-level="5.2.2" data-path="challenges.html"><a href="challenges.html#itp-with-mste-objective-itp-mste"><i class="fa fa-check"></i><b>5.2.2</b> ITP with MSTE objective (ITP-MSTE)</a></li>
<li class="chapter" data-level="5.2.3" data-path="challenges.html"><a href="challenges.html#example-itp"><i class="fa fa-check"></i><b>5.2.3</b> Example ITP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html"><i class="fa fa-check"></i><b>6</b> Analytic Solver for Quadratic Programming Problems</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#quadratic-programming-qp"><i class="fa fa-check"></i><b>6.1</b> Quadratic Programming (QP)</a></li>
<li class="chapter" data-level="6.2" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#qp-solver-from-quadprog"><i class="fa fa-check"></i><b>6.2</b> QP Solver from quadprog</a></li>
<li class="chapter" data-level="6.3" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#exampleanalyticalmvp"><i class="fa fa-check"></i><b>6.3</b> Example: Solving MVP with <code>solve.QP()</code></a></li>
<li class="chapter" data-level="6.4" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#exampleitpsolveqp"><i class="fa fa-check"></i><b>6.4</b> Example: Solving ITP-MSTE with <code>solve.QP()</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html"><i class="fa fa-check"></i><b>7</b> Particle Swarm Optimization (PSO)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#the-algorithm"><i class="fa fa-check"></i><b>7.1</b> The Algorithm</a></li>
<li class="chapter" data-level="7.2" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#pso-function"><i class="fa fa-check"></i><b>7.2</b> <code>pso()</code> Function</a></li>
<li class="chapter" data-level="7.3" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#animation-2-dimensional"><i class="fa fa-check"></i><b>7.3</b> Animation 2-Dimensional</a></li>
<li class="chapter" data-level="7.4" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-mvp"><i class="fa fa-check"></i><b>7.4</b> Example MVP</a></li>
<li class="chapter" data-level="7.5" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-itp-mste"><i class="fa fa-check"></i><b>7.5</b> Example: ITP-MSTE</a></li>
<li class="chapter" data-level="7.6" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#pros-and-cons-for-continuous-problems"><i class="fa fa-check"></i><b>7.6</b> Pros and Cons for Continuous Problems</a></li>
<li class="chapter" data-level="7.7" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#discrete-problems-and-transaction-costs"><i class="fa fa-check"></i><b>7.7</b> Discrete Problems and Transaction Costs</a></li>
<li class="chapter" data-level="7.8" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-discrete-itp-mste"><i class="fa fa-check"></i><b>7.8</b> Example: Discrete ITP-MSTE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/AxelCode-R/Master-Thesis" target="blank">GitHub Repository</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Asset Allocation using Particle Swarm Optimization in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="particle-swarm-optimization-pso" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Particle Swarm Optimization (PSO)<a href="particle-swarm-optimization-pso.html#particle-swarm-optimization-pso" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The PSO was developed by J. Kennedy as a global optimization method based on swarm intelligence and presented to the public in 1995 by Eberhart and Kennedy <span class="citation">(<a href="#ref-KeEb1995" role="doc-biblioref">James Kennedy 1995</a>)</span>. The original PSO was intended to resemble a flock of birds flying through the sky without collisions. Therefore, its first applications were found in particle physics to analyze moving particles in high-dimensional spaces, which the name Particle recalls. Later, it was adapted in Evolutionary Computation to exploit a set of potential solutions in high dimensions and to find the optima by cooperating with other particles in the swarm <span class="citation">(<a href="#ref-PaVr2002" role="doc-biblioref">Konstantinos Parsopoulos 2002</a>)</span>. Since it does not require gradient information, it is easier to apply than other global optimization methods. It can find the optimum by considering only the result of the function to be optimized. This means that the function can be arbitrarily complex and it is still possible to reach the global optimum. Other advantages are the low computational costs, since only basic mathematical operators are used.</p>
<div id="the-algorithm" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> The Algorithm<a href="particle-swarm-optimization-pso.html#the-algorithm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Each particle <span class="math inline">\(d\)</span> with position <span class="math inline">\(x_d\)</span> moves in the search space <span class="math inline">\(\mathbb{R}^N\)</span> and has its own velocity <span class="math inline">\(v_d\)</span> and remembers its previous best position <span class="math inline">\(P_d\)</span>. After each iteration, the velocity changes in the direction of the intrinsic velocity, the best previous position, and the global best position <span class="math inline">\(p_g\)</span> of all particles. A position change from <span class="math inline">\(i\)</span> to <span class="math inline">\(i+1\)</span> can be calculated by the following two equations <span class="citation">(<a href="#ref-PaVr2002" role="doc-biblioref">Konstantinos Parsopoulos 2002</a>)</span>:
<span class="math display">\[\begin{align*}
  v_d^{i+1} &amp;= wv_d^{i} + c_p r_1^i (P_d^i - x_d^i) + c_g r_2^i (p_g^i - x_d^i) \\
  x_d^{i+1} &amp;= x_d^i + v_d^{i+1}
\end{align*}\]</span></p>
<p>Where <span class="math inline">\(r_1\)</span> and <span class="math inline">\(r_2\)</span> are uniformly distributed random numbers in [0, 1]. The cognitive parameter <span class="math inline">\(c_p\)</span> acts as a weighting of the direction to its previous best position of the particle. This contrasts with the social parameter <span class="math inline">\(c_g\)</span>, which is a weighting of the direction to the global best position. The inertial weight <span class="math inline">\(w\)</span> is crucial for the convergence behavior by remembering part of its previous trajectory. A study reviewed in <span class="citation">(<a href="#ref-PaVr2002" role="doc-biblioref">Konstantinos Parsopoulos 2002</a>)</span> showed that these parameters can be set to <span class="math inline">\(c_p=c_g=0.5\)</span> and <span class="math inline">\(w\)</span> should decrease from <span class="math inline">\(1.2\)</span> to <span class="math inline">\(0\)</span>. However, some problems benefit from a more precise tuning of these parameters. To allow effortless translation to code, the above formula for <span class="math inline">\(d = 1, 2, \cdots, D\)</span> particles can be given in the following matrix notation:
<span class="math display">\[\begin{align*}
  V^{i+1} &amp;= w \cdot V^{i} + c_p \cdot r_1^i \cdot (P^i-X^i) + c_g \cdot r_2^i \cdot (p_g^i - X^i) \\
  X^{i+1} &amp;= X^i + V^{i+1}
\end{align*}\]</span></p>
<p>With current positions <span class="math inline">\(X \in \mathbb{R}^{N \times D}\)</span>, current velocities <span class="math inline">\(V \in \mathbb{R}^{N \times D}\)</span>, previous best positions <span class="math inline">\(P \in \mathbb{R}^{N \times D}\)</span>, and global best position <span class="math inline">\(p_g \in \mathbb{R}^{N}\)</span>. The parameters <span class="math inline">\(w\)</span>, <span class="math inline">\(c_p\)</span>, <span class="math inline">\(c_g\)</span>, <span class="math inline">\(r_1\)</span> and <span class="math inline">\(r_2\)</span> are stile scalars.</p>
</div>
<div id="pso-function" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> <code>pso()</code> Function<a href="particle-swarm-optimization-pso.html#pso-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, a general PSO function is created that follows the structure of other optimization heuristics in R, in particular the existing PSO implementation from the R package <code>pso</code>. The key component of the problem is a objective function called <code>fn()</code>, which returns a scalar that needs to be minimized. The function itself mainly needs a vector <code>pos</code> that describes the position of a particle (e.g. weights). The other main parameters for the PSO function are <code>par</code>, which is a position of a particle used to derive the dimension of the problem and used as the initial position of one particle. The argument can only contain <code>NA</code>’s, resulting in completely random starting positions. The last two arguments are <code>lower</code> and <code>upper</code> bounds (e.g. weights greater than 0 and less than 1). All other parameters have default values that can be overridden by passing a list called <code>control</code>. The resulting structure is:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="particle-swarm-optimization-pso.html#cb19-1" aria-hidden="true" tabindex="-1"></a>pso <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb19-2"><a href="particle-swarm-optimization-pso.html#cb19-2" aria-hidden="true" tabindex="-1"></a>    par, </span>
<span id="cb19-3"><a href="particle-swarm-optimization-pso.html#cb19-3" aria-hidden="true" tabindex="-1"></a>    fn, </span>
<span id="cb19-4"><a href="particle-swarm-optimization-pso.html#cb19-4" aria-hidden="true" tabindex="-1"></a>    lower, </span>
<span id="cb19-5"><a href="particle-swarm-optimization-pso.html#cb19-5" aria-hidden="true" tabindex="-1"></a>    upper, </span>
<span id="cb19-6"><a href="particle-swarm-optimization-pso.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>()</span>
<span id="cb19-7"><a href="particle-swarm-optimization-pso.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  ){</span>
<span id="cb19-8"><a href="particle-swarm-optimization-pso.html#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="particle-swarm-optimization-pso.html#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Before the main data structure can be initialized, some sample inputs must be created for the <code>pso()</code> function as described below:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="particle-swarm-optimization-pso.html#cb20-1" aria-hidden="true" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">2</span>)</span>
<span id="cb20-2"><a href="particle-swarm-optimization-pso.html#cb20-2" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">abs</span>(x)))}</span>
<span id="cb20-3"><a href="particle-swarm-optimization-pso.html#cb20-3" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">10</span></span>
<span id="cb20-4"><a href="particle-swarm-optimization-pso.html#cb20-4" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb20-5"><a href="particle-swarm-optimization-pso.html#cb20-5" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb20-6"><a href="particle-swarm-optimization-pso.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> <span class="dv">10</span>, <span class="co"># swarm size</span></span>
<span id="cb20-7"><a href="particle-swarm-optimization-pso.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb20-8"><a href="particle-swarm-optimization-pso.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb20-9"><a href="particle-swarm-optimization-pso.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb20-10"><a href="particle-swarm-optimization-pso.html#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb20-11"><a href="particle-swarm-optimization-pso.html#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb20-12"><a href="particle-swarm-optimization-pso.html#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb20-13"><a href="particle-swarm-optimization-pso.html#cb20-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now it is time to initialize the random positions <code>X</code>, their fitness <code>X_fit</code> and their random velocities <code>V</code> with the function <code>mrunif()</code> which produces a matrix of uniformly distributed random numbers between <code>lower</code> and <code>upper</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="particle-swarm-optimization-pso.html#cb21-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">mrunif</span>(</span>
<span id="cb21-2"><a href="particle-swarm-optimization-pso.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">nr =</span> <span class="fu">length</span>(par), <span class="at">nc=</span>control<span class="sc">$</span>s, <span class="at">lower=</span>lower, <span class="at">upper=</span>upper</span>
<span id="cb21-3"><a href="particle-swarm-optimization-pso.html#cb21-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-4"><a href="particle-swarm-optimization-pso.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(par))){</span>
<span id="cb21-5"><a href="particle-swarm-optimization-pso.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  X[, <span class="dv">1</span>] <span class="ot">&lt;-</span> par</span>
<span id="cb21-6"><a href="particle-swarm-optimization-pso.html#cb21-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-7"><a href="particle-swarm-optimization-pso.html#cb21-7" aria-hidden="true" tabindex="-1"></a>X_fit <span class="ot">&lt;-</span> <span class="fu">apply</span>(X, <span class="dv">2</span>, fn)</span>
<span id="cb21-8"><a href="particle-swarm-optimization-pso.html#cb21-8" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">mrunif</span>(</span>
<span id="cb21-9"><a href="particle-swarm-optimization-pso.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">nr =</span> <span class="fu">length</span>(par), <span class="at">nc=</span>control<span class="sc">$</span>s, </span>
<span id="cb21-10"><a href="particle-swarm-optimization-pso.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower=</span><span class="sc">-</span>(upper<span class="sc">-</span>lower), <span class="at">upper=</span>(upper<span class="sc">-</span>lower)</span>
<span id="cb21-11"><a href="particle-swarm-optimization-pso.html#cb21-11" aria-hidden="true" tabindex="-1"></a>)<span class="sc">/</span><span class="dv">4</span></span></code></pre></div>
<p>The velocities are compressed by a factor of 4 to start with a maximum movement of one quarter of the space in each axis. The personal best positions <code>P</code> are the same as <code>X</code> and the global best position is the position with the smallest fitness:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="particle-swarm-optimization-pso.html#cb22-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> X</span>
<span id="cb22-2"><a href="particle-swarm-optimization-pso.html#cb22-2" aria-hidden="true" tabindex="-1"></a>P_fit <span class="ot">&lt;-</span> X_fit</span>
<span id="cb22-3"><a href="particle-swarm-optimization-pso.html#cb22-3" aria-hidden="true" tabindex="-1"></a>p_g <span class="ot">&lt;-</span> P[, <span class="fu">which.min</span>(P_fit)]</span>
<span id="cb22-4"><a href="particle-swarm-optimization-pso.html#cb22-4" aria-hidden="true" tabindex="-1"></a>p_g_fit <span class="ot">&lt;-</span> <span class="fu">which.min</span>(P_fit)</span></code></pre></div>
<p>The required data structure is available and the optimization can start with the calculation of the new velocities and the transformation of the old positions. When particles have left the valid space, they are pushed back to the edge and the velocities are set to zero. Then the fitness is calculated and the personal best and global best positions are saved if they have improved.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="particle-swarm-optimization-pso.html#cb23-1" aria-hidden="true" tabindex="-1"></a>trace_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-2"><a href="particle-swarm-optimization-pso.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>control<span class="sc">$</span>maxiter){</span>
<span id="cb23-3"><a href="particle-swarm-optimization-pso.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move particles</span></span>
<span id="cb23-4"><a href="particle-swarm-optimization-pso.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> </span>
<span id="cb23-5"><a href="particle-swarm-optimization-pso.html#cb23-5" aria-hidden="true" tabindex="-1"></a>    (control<span class="sc">$</span>w0<span class="sc">-</span>(control<span class="sc">$</span>w0<span class="sc">-</span>control<span class="sc">$</span>wN)<span class="sc">*</span>i<span class="sc">/</span>control<span class="sc">$</span>maxiter) <span class="sc">*</span> V <span class="sc">+</span> </span>
<span id="cb23-6"><a href="particle-swarm-optimization-pso.html#cb23-6" aria-hidden="true" tabindex="-1"></a>    control<span class="sc">$</span>c.p <span class="sc">*</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">*</span> (P<span class="sc">-</span>X) <span class="sc">+</span> </span>
<span id="cb23-7"><a href="particle-swarm-optimization-pso.html#cb23-7" aria-hidden="true" tabindex="-1"></a>    control<span class="sc">$</span>c.g <span class="sc">*</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">*</span> (p_g<span class="sc">-</span>X)</span>
<span id="cb23-8"><a href="particle-swarm-optimization-pso.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> X <span class="sc">+</span> V</span>
<span id="cb23-9"><a href="particle-swarm-optimization-pso.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-10"><a href="particle-swarm-optimization-pso.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set velocity to zeros if not in valid space</span></span>
<span id="cb23-11"><a href="particle-swarm-optimization-pso.html#cb23-11" aria-hidden="true" tabindex="-1"></a>  V[X <span class="sc">&gt;</span> upper] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-12"><a href="particle-swarm-optimization-pso.html#cb23-12" aria-hidden="true" tabindex="-1"></a>  V[X <span class="sc">&lt;</span> lower] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-13"><a href="particle-swarm-optimization-pso.html#cb23-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-14"><a href="particle-swarm-optimization-pso.html#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># move into valid space</span></span>
<span id="cb23-15"><a href="particle-swarm-optimization-pso.html#cb23-15" aria-hidden="true" tabindex="-1"></a>  X[X <span class="sc">&gt;</span> upper] <span class="ot">&lt;-</span> upper</span>
<span id="cb23-16"><a href="particle-swarm-optimization-pso.html#cb23-16" aria-hidden="true" tabindex="-1"></a>  X[X <span class="sc">&lt;</span> lower] <span class="ot">&lt;-</span> lower</span>
<span id="cb23-17"><a href="particle-swarm-optimization-pso.html#cb23-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-18"><a href="particle-swarm-optimization-pso.html#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># evaluate objective function</span></span>
<span id="cb23-19"><a href="particle-swarm-optimization-pso.html#cb23-19" aria-hidden="true" tabindex="-1"></a>  X_fit <span class="ot">&lt;-</span> <span class="fu">apply</span>(X, <span class="dv">2</span>, fn)</span>
<span id="cb23-20"><a href="particle-swarm-optimization-pso.html#cb23-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-21"><a href="particle-swarm-optimization-pso.html#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save new previews best</span></span>
<span id="cb23-22"><a href="particle-swarm-optimization-pso.html#cb23-22" aria-hidden="true" tabindex="-1"></a>  P[, P_fit <span class="sc">&gt;</span> X_fit] <span class="ot">&lt;-</span> X[, P_fit <span class="sc">&gt;</span> X_fit]</span>
<span id="cb23-23"><a href="particle-swarm-optimization-pso.html#cb23-23" aria-hidden="true" tabindex="-1"></a>  P_fit[P_fit <span class="sc">&gt;</span> X_fit] <span class="ot">&lt;-</span> X_fit[P_fit <span class="sc">&gt;</span> X_fit]</span>
<span id="cb23-24"><a href="particle-swarm-optimization-pso.html#cb23-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-25"><a href="particle-swarm-optimization-pso.html#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save new global best</span></span>
<span id="cb23-26"><a href="particle-swarm-optimization-pso.html#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(P_fit <span class="sc">&lt;</span> p_g_fit)){</span>
<span id="cb23-27"><a href="particle-swarm-optimization-pso.html#cb23-27" aria-hidden="true" tabindex="-1"></a>    p_g <span class="ot">&lt;-</span> P[, <span class="fu">which.min</span>(P_fit)]</span>
<span id="cb23-28"><a href="particle-swarm-optimization-pso.html#cb23-28" aria-hidden="true" tabindex="-1"></a>    p_g_fit <span class="ot">&lt;-</span> <span class="fu">min</span>(P_fit)</span>
<span id="cb23-29"><a href="particle-swarm-optimization-pso.html#cb23-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-30"><a href="particle-swarm-optimization-pso.html#cb23-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-31"><a href="particle-swarm-optimization-pso.html#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(control<span class="sc">$</span>save_traces<span class="sc">==</span><span class="cn">TRUE</span>){</span>
<span id="cb23-32"><a href="particle-swarm-optimization-pso.html#cb23-32" aria-hidden="true" tabindex="-1"></a>    trace_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trace_data, <span class="fu">data.frame</span>(<span class="st">&quot;iter&quot;</span><span class="ot">=</span>i, <span class="fu">t</span>(X)))</span>
<span id="cb23-33"><a href="particle-swarm-optimization-pso.html#cb23-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-34"><a href="particle-swarm-optimization-pso.html#cb23-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The best fitness after <span class="math inline">\(100\)</span> iterations is 0.0000036 and the best possible solution is <span class="math inline">\(0\)</span>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb24-1"><a href="particle-swarm-optimization-pso.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the resulting pso() function</span></span>
<span id="cb24-2"><a href="particle-swarm-optimization-pso.html#cb24-2" aria-hidden="true" tabindex="-1"></a>pso <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb24-3"><a href="particle-swarm-optimization-pso.html#cb24-3" aria-hidden="true" tabindex="-1"></a>    par, </span>
<span id="cb24-4"><a href="particle-swarm-optimization-pso.html#cb24-4" aria-hidden="true" tabindex="-1"></a>    fn, </span>
<span id="cb24-5"><a href="particle-swarm-optimization-pso.html#cb24-5" aria-hidden="true" tabindex="-1"></a>    lower, </span>
<span id="cb24-6"><a href="particle-swarm-optimization-pso.html#cb24-6" aria-hidden="true" tabindex="-1"></a>    upper, </span>
<span id="cb24-7"><a href="particle-swarm-optimization-pso.html#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>()</span>
<span id="cb24-8"><a href="particle-swarm-optimization-pso.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  ){</span>
<span id="cb24-9"><a href="particle-swarm-optimization-pso.html#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="particle-swarm-optimization-pso.html#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use default control values if not set</span></span>
<span id="cb24-11"><a href="particle-swarm-optimization-pso.html#cb24-11" aria-hidden="true" tabindex="-1"></a>  control_ <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb24-12"><a href="particle-swarm-optimization-pso.html#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">s =</span> <span class="dv">10</span>, <span class="co"># swarm size</span></span>
<span id="cb24-13"><a href="particle-swarm-optimization-pso.html#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb24-14"><a href="particle-swarm-optimization-pso.html#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb24-15"><a href="particle-swarm-optimization-pso.html#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxiter =</span> <span class="dv">200</span>, <span class="co"># iterations</span></span>
<span id="cb24-16"><a href="particle-swarm-optimization-pso.html#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb24-17"><a href="particle-swarm-optimization-pso.html#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb24-18"><a href="particle-swarm-optimization-pso.html#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb24-19"><a href="particle-swarm-optimization-pso.html#cb24-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-20"><a href="particle-swarm-optimization-pso.html#cb24-20" aria-hidden="true" tabindex="-1"></a>  control <span class="ot">&lt;-</span> <span class="fu">c</span>(control, control_[<span class="sc">!</span><span class="fu">names</span>(control_) <span class="sc">%in%</span> <span class="fu">names</span>(control)])</span>
<span id="cb24-21"><a href="particle-swarm-optimization-pso.html#cb24-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-22"><a href="particle-swarm-optimization-pso.html#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># init data-structure</span></span>
<span id="cb24-23"><a href="particle-swarm-optimization-pso.html#cb24-23" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">mrunif</span>(</span>
<span id="cb24-24"><a href="particle-swarm-optimization-pso.html#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">nr =</span> <span class="fu">length</span>(par), <span class="at">nc=</span>control<span class="sc">$</span>s, <span class="at">lower=</span>lower, <span class="at">upper=</span>upper</span>
<span id="cb24-25"><a href="particle-swarm-optimization-pso.html#cb24-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-26"><a href="particle-swarm-optimization-pso.html#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(par))){</span>
<span id="cb24-27"><a href="particle-swarm-optimization-pso.html#cb24-27" aria-hidden="true" tabindex="-1"></a>    X[, <span class="dv">1</span>] <span class="ot">&lt;-</span> par</span>
<span id="cb24-28"><a href="particle-swarm-optimization-pso.html#cb24-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-29"><a href="particle-swarm-optimization-pso.html#cb24-29" aria-hidden="true" tabindex="-1"></a>  X_fit <span class="ot">&lt;-</span> <span class="fu">apply</span>(X, <span class="dv">2</span>, fn)</span>
<span id="cb24-30"><a href="particle-swarm-optimization-pso.html#cb24-30" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> <span class="fu">mrunif</span>(</span>
<span id="cb24-31"><a href="particle-swarm-optimization-pso.html#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">nr =</span> <span class="fu">length</span>(par), <span class="at">nc=</span>control<span class="sc">$</span>s, </span>
<span id="cb24-32"><a href="particle-swarm-optimization-pso.html#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower=</span><span class="sc">-</span>(upper<span class="sc">-</span>lower), <span class="at">upper=</span>(upper<span class="sc">-</span>lower)</span>
<span id="cb24-33"><a href="particle-swarm-optimization-pso.html#cb24-33" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb24-34"><a href="particle-swarm-optimization-pso.html#cb24-34" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> X</span>
<span id="cb24-35"><a href="particle-swarm-optimization-pso.html#cb24-35" aria-hidden="true" tabindex="-1"></a>  P_fit <span class="ot">&lt;-</span> X_fit</span>
<span id="cb24-36"><a href="particle-swarm-optimization-pso.html#cb24-36" aria-hidden="true" tabindex="-1"></a>  p_g <span class="ot">&lt;-</span> P[, <span class="fu">which.min</span>(P_fit)]</span>
<span id="cb24-37"><a href="particle-swarm-optimization-pso.html#cb24-37" aria-hidden="true" tabindex="-1"></a>  p_g_fit <span class="ot">&lt;-</span> <span class="fu">which.min</span>(P_fit)</span>
<span id="cb24-38"><a href="particle-swarm-optimization-pso.html#cb24-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-39"><a href="particle-swarm-optimization-pso.html#cb24-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-40"><a href="particle-swarm-optimization-pso.html#cb24-40" aria-hidden="true" tabindex="-1"></a>  trace_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb24-41"><a href="particle-swarm-optimization-pso.html#cb24-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>control<span class="sc">$</span>maxiter){</span>
<span id="cb24-42"><a href="particle-swarm-optimization-pso.html#cb24-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-43"><a href="particle-swarm-optimization-pso.html#cb24-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move particles</span></span>
<span id="cb24-44"><a href="particle-swarm-optimization-pso.html#cb24-44" aria-hidden="true" tabindex="-1"></a>    V <span class="ot">&lt;-</span> </span>
<span id="cb24-45"><a href="particle-swarm-optimization-pso.html#cb24-45" aria-hidden="true" tabindex="-1"></a>      (control<span class="sc">$</span>w0<span class="sc">-</span>(control<span class="sc">$</span>w0<span class="sc">-</span>control<span class="sc">$</span>wN)<span class="sc">*</span>i<span class="sc">/</span>control<span class="sc">$</span>maxiter) <span class="sc">*</span> V <span class="sc">+</span> </span>
<span id="cb24-46"><a href="particle-swarm-optimization-pso.html#cb24-46" aria-hidden="true" tabindex="-1"></a>      control<span class="sc">$</span>c.p <span class="sc">*</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">*</span> (P<span class="sc">-</span>X) <span class="sc">+</span> </span>
<span id="cb24-47"><a href="particle-swarm-optimization-pso.html#cb24-47" aria-hidden="true" tabindex="-1"></a>      control<span class="sc">$</span>c.g <span class="sc">*</span> <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">*</span> (p_g<span class="sc">-</span>X)</span>
<span id="cb24-48"><a href="particle-swarm-optimization-pso.html#cb24-48" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> X <span class="sc">+</span> V</span>
<span id="cb24-49"><a href="particle-swarm-optimization-pso.html#cb24-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-50"><a href="particle-swarm-optimization-pso.html#cb24-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set velocity to zeros if not in valid space</span></span>
<span id="cb24-51"><a href="particle-swarm-optimization-pso.html#cb24-51" aria-hidden="true" tabindex="-1"></a>    V[X <span class="sc">&gt;</span> upper] <span class="ot">&lt;-</span> <span class="sc">-</span>V[X <span class="sc">&gt;</span> upper]</span>
<span id="cb24-52"><a href="particle-swarm-optimization-pso.html#cb24-52" aria-hidden="true" tabindex="-1"></a>    V[X <span class="sc">&lt;</span> lower] <span class="ot">&lt;-</span> <span class="sc">-</span>V[X <span class="sc">&lt;</span> lower]</span>
<span id="cb24-53"><a href="particle-swarm-optimization-pso.html#cb24-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-54"><a href="particle-swarm-optimization-pso.html#cb24-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># move into valid space</span></span>
<span id="cb24-55"><a href="particle-swarm-optimization-pso.html#cb24-55" aria-hidden="true" tabindex="-1"></a>    X[X <span class="sc">&gt;</span> upper] <span class="ot">&lt;-</span> upper</span>
<span id="cb24-56"><a href="particle-swarm-optimization-pso.html#cb24-56" aria-hidden="true" tabindex="-1"></a>    X[X <span class="sc">&lt;</span> lower] <span class="ot">&lt;-</span> lower</span>
<span id="cb24-57"><a href="particle-swarm-optimization-pso.html#cb24-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-58"><a href="particle-swarm-optimization-pso.html#cb24-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evaluate objective function</span></span>
<span id="cb24-59"><a href="particle-swarm-optimization-pso.html#cb24-59" aria-hidden="true" tabindex="-1"></a>    X_fit <span class="ot">&lt;-</span> <span class="fu">apply</span>(X, <span class="dv">2</span>, fn)</span>
<span id="cb24-60"><a href="particle-swarm-optimization-pso.html#cb24-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-61"><a href="particle-swarm-optimization-pso.html#cb24-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save new previews best</span></span>
<span id="cb24-62"><a href="particle-swarm-optimization-pso.html#cb24-62" aria-hidden="true" tabindex="-1"></a>    P[, P_fit <span class="sc">&gt;</span> X_fit] <span class="ot">&lt;-</span> X[, P_fit <span class="sc">&gt;</span> X_fit]</span>
<span id="cb24-63"><a href="particle-swarm-optimization-pso.html#cb24-63" aria-hidden="true" tabindex="-1"></a>    P_fit[P_fit <span class="sc">&gt;</span> X_fit] <span class="ot">&lt;-</span> X_fit[P_fit <span class="sc">&gt;</span> X_fit]</span>
<span id="cb24-64"><a href="particle-swarm-optimization-pso.html#cb24-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-65"><a href="particle-swarm-optimization-pso.html#cb24-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save new global best</span></span>
<span id="cb24-66"><a href="particle-swarm-optimization-pso.html#cb24-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(P_fit <span class="sc">&lt;</span> p_g_fit)){</span>
<span id="cb24-67"><a href="particle-swarm-optimization-pso.html#cb24-67" aria-hidden="true" tabindex="-1"></a>      p_g <span class="ot">&lt;-</span> P[, <span class="fu">which.min</span>(P_fit)]</span>
<span id="cb24-68"><a href="particle-swarm-optimization-pso.html#cb24-68" aria-hidden="true" tabindex="-1"></a>      p_g_fit <span class="ot">&lt;-</span> <span class="fu">min</span>(P_fit)</span>
<span id="cb24-69"><a href="particle-swarm-optimization-pso.html#cb24-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-70"><a href="particle-swarm-optimization-pso.html#cb24-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-71"><a href="particle-swarm-optimization-pso.html#cb24-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(control<span class="sc">$</span>save_traces){</span>
<span id="cb24-72"><a href="particle-swarm-optimization-pso.html#cb24-72" aria-hidden="true" tabindex="-1"></a>      trace_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trace_data, <span class="fu">data.frame</span>(<span class="st">&quot;iter&quot;</span><span class="ot">=</span>i, <span class="fu">t</span>(X)))</span>
<span id="cb24-73"><a href="particle-swarm-optimization-pso.html#cb24-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-74"><a href="particle-swarm-optimization-pso.html#cb24-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-75"><a href="particle-swarm-optimization-pso.html#cb24-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-76"><a href="particle-swarm-optimization-pso.html#cb24-76" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-77"><a href="particle-swarm-optimization-pso.html#cb24-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;solution&quot;</span> <span class="ot">=</span> p_g,</span>
<span id="cb24-78"><a href="particle-swarm-optimization-pso.html#cb24-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fitness&quot;</span> <span class="ot">=</span> p_g_fit</span>
<span id="cb24-79"><a href="particle-swarm-optimization-pso.html#cb24-79" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-80"><a href="particle-swarm-optimization-pso.html#cb24-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(control<span class="sc">$</span>save_traces){</span>
<span id="cb24-81"><a href="particle-swarm-optimization-pso.html#cb24-81" aria-hidden="true" tabindex="-1"></a>    res<span class="sc">$</span>trace_data <span class="ot">&lt;-</span> trace_data</span>
<span id="cb24-82"><a href="particle-swarm-optimization-pso.html#cb24-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-83"><a href="particle-swarm-optimization-pso.html#cb24-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb24-84"><a href="particle-swarm-optimization-pso.html#cb24-84" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="animation-2-dimensional" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Animation 2-Dimensional<a href="particle-swarm-optimization-pso.html#animation-2-dimensional" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section provides insights into the behavior of the PSO by visualizing multiple iterations in a GIF. The GIF only works in Adobe Acrobat DC or in the Markdown/HTML version of this thesis. The amazing animation template is inspired by <a href="https://www.r-bloggers.com/2021/10/how-to-build-a-basic-particle-swarm-optimiser-from-scratch-in-r/">R’tichoke</a>. The PSO core from the above chapter was used to complete the <code>pso()</code> function and is tested here with seed 0. The function <code>fn</code> to be evaluated can be found in <a href="https://www.r-bloggers.com/2021/10/how-to-build-a-basic-particle-swarm-optimiser-from-scratch-in-r/">R’tichoke</a>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="particle-swarm-optimization-pso.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb25-2"><a href="particle-swarm-optimization-pso.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="particle-swarm-optimization-pso.html#cb25-3" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>(pos){</span>
<span id="cb25-4"><a href="particle-swarm-optimization-pso.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="dv">20</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fl">0.5</span> <span class="sc">*</span>((pos[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (pos[<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">-</span> </span>
<span id="cb25-5"><a href="particle-swarm-optimization-pso.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="fl">0.5</span><span class="sc">*</span>(<span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>pos[<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">cos</span>(<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>pos[<span class="dv">2</span>]))) <span class="sc">+</span> </span>
<span id="cb25-6"><a href="particle-swarm-optimization-pso.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="dv">20</span></span>
<span id="cb25-7"><a href="particle-swarm-optimization-pso.html#cb25-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-8"><a href="particle-swarm-optimization-pso.html#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="particle-swarm-optimization-pso.html#cb25-9" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb25-10"><a href="particle-swarm-optimization-pso.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">par =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">2</span>),</span>
<span id="cb25-11"><a href="particle-swarm-optimization-pso.html#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">fn =</span> fn,</span>
<span id="cb25-12"><a href="particle-swarm-optimization-pso.html#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="sc">-</span><span class="dv">10</span>,</span>
<span id="cb25-13"><a href="particle-swarm-optimization-pso.html#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="dv">10</span>,</span>
<span id="cb25-14"><a href="particle-swarm-optimization-pso.html#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb25-15"><a href="particle-swarm-optimization-pso.html#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">s =</span> <span class="dv">10</span>,</span>
<span id="cb25-16"><a href="particle-swarm-optimization-pso.html#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">maxiter =</span> <span class="dv">30</span>,</span>
<span id="cb25-17"><a href="particle-swarm-optimization-pso.html#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">w0 =</span> <span class="fl">0.8</span>,</span>
<span id="cb25-18"><a href="particle-swarm-optimization-pso.html#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_traces =</span> T</span>
<span id="cb25-19"><a href="particle-swarm-optimization-pso.html#cb25-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-20"><a href="particle-swarm-optimization-pso.html#cb25-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The function <code>fn</code> has many local minima and a global minima at <span class="math inline">\((1,1)\)</span> with the value <span class="math inline">\(0\)</span>. The background color scale ranges from 0 as red to 20 as purple. The PSO has 10 particles, iterated 30 times with an inertia weight decreasing from 0.8 to 0. The iterations are visualized in the following GIF:</p>
<p><img src="Master_Thesis_files/figure-html/gif_animate-1.gif" /><!-- --></p>
</div>
<div id="example-mvp" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Example MVP<a href="particle-swarm-optimization-pso.html#example-mvp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This example uses the <code>solve.QP()</code> approach from <a href="analytic-solver-for-quadratic-programming-problems.html#exampleanalyticalmvp">6.3</a> with ten assets as the benchmark. Briefly, the goal is to create an MVP from ten of the largest U.S. stocks between 2018-01-01 and 2019-12-31 for each possible <span class="math inline">\(\lambda\)</span>. The PSO has 300 particles and 200 iterations for each lambda. The main characteristics of all portfolios created with the <code>solve.QP()</code> compared to the PSO are shown below:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb26-1"><a href="particle-swarm-optimization-pso.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb26-2"><a href="particle-swarm-optimization-pso.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="particle-swarm-optimization-pso.html#cb26-3" aria-hidden="true" tabindex="-1"></a>returns_raw <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb26-4"><a href="particle-swarm-optimization-pso.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(</span>
<span id="cb26-5"><a href="particle-swarm-optimization-pso.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tickers =</span> <span class="fu">c</span>(<span class="st">&quot;IBM&quot;</span>, <span class="st">&quot;GOOG&quot;</span>, <span class="st">&quot;AAPL&quot;</span>, <span class="st">&quot;MSFT&quot;</span>, <span class="st">&quot;AMZN&quot;</span>, </span>
<span id="cb26-6"><a href="particle-swarm-optimization-pso.html#cb26-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;NVDA&quot;</span>, <span class="st">&quot;JPM&quot;</span>, <span class="st">&quot;META&quot;</span>, <span class="st">&quot;V&quot;</span>, <span class="st">&quot;WMT&quot;</span>), </span>
<span id="cb26-7"><a href="particle-swarm-optimization-pso.html#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="st">&quot;2018-01-01&quot;</span>, </span>
<span id="cb26-8"><a href="particle-swarm-optimization-pso.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="st">&quot;2019-12-31&quot;</span></span>
<span id="cb26-9"><a href="particle-swarm-optimization-pso.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>returns, </span>
<span id="cb26-10"><a href="particle-swarm-optimization-pso.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_10_assets&quot;</span></span>
<span id="cb26-11"><a href="particle-swarm-optimization-pso.html#cb26-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-12"><a href="particle-swarm-optimization-pso.html#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="particle-swarm-optimization-pso.html#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># re-arrange: low var first</span></span>
<span id="cb26-14"><a href="particle-swarm-optimization-pso.html#cb26-14" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">sapply</span>(returns_raw, var)</span>
<span id="cb26-15"><a href="particle-swarm-optimization-pso.html#cb26-15" aria-hidden="true" tabindex="-1"></a>returns_raw <span class="ot">&lt;-</span> returns_raw[, <span class="fu">order</span>(vars, <span class="at">decreasing =</span> F)]</span>
<span id="cb26-16"><a href="particle-swarm-optimization-pso.html#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="particle-swarm-optimization-pso.html#cb26-17" aria-hidden="true" tabindex="-1"></a>mvp_QP <span class="ot">&lt;-</span> <span class="cf">function</span>(returns, lambda){</span>
<span id="cb26-18"><a href="particle-swarm-optimization-pso.html#cb26-18" aria-hidden="true" tabindex="-1"></a>  tc <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb26-19"><a href="particle-swarm-optimization-pso.html#cb26-19" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">ret_to_geomeanret</span>(returns)</span>
<span id="cb26-20"><a href="particle-swarm-optimization-pso.html#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="particle-swarm-optimization-pso.html#cb26-21" aria-hidden="true" tabindex="-1"></a>    cov <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">nearPD</span>(<span class="fu">cov</span>(returns))<span class="sc">$</span>mat)</span>
<span id="cb26-22"><a href="particle-swarm-optimization-pso.html#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="particle-swarm-optimization-pso.html#cb26-23" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-24"><a href="particle-swarm-optimization-pso.html#cb26-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dmat =</span> lambda <span class="sc">*</span> cov,</span>
<span id="cb26-25"><a href="particle-swarm-optimization-pso.html#cb26-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">dvec =</span> (<span class="dv">1</span><span class="sc">-</span>lambda) <span class="sc">*</span> mu,</span>
<span id="cb26-26"><a href="particle-swarm-optimization-pso.html#cb26-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb26-27"><a href="particle-swarm-optimization-pso.html#cb26-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(returns)), <span class="co"># sum up to 1</span></span>
<span id="cb26-28"><a href="particle-swarm-optimization-pso.html#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">ncol</span>(returns), <span class="at">ncol=</span><span class="fu">ncol</span>(returns)) <span class="co"># long only</span></span>
<span id="cb26-29"><a href="particle-swarm-optimization-pso.html#cb26-29" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb26-30"><a href="particle-swarm-optimization-pso.html#cb26-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb26-31"><a href="particle-swarm-optimization-pso.html#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb26-32"><a href="particle-swarm-optimization-pso.html#cb26-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(returns)) <span class="co"># long only</span></span>
<span id="cb26-33"><a href="particle-swarm-optimization-pso.html#cb26-33" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb26-34"><a href="particle-swarm-optimization-pso.html#cb26-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb26-35"><a href="particle-swarm-optimization-pso.html#cb26-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-36"><a href="particle-swarm-optimization-pso.html#cb26-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-37"><a href="particle-swarm-optimization-pso.html#cb26-37" aria-hidden="true" tabindex="-1"></a>    qp <span class="ot">&lt;-</span> <span class="fu">solve.QP</span>(</span>
<span id="cb26-38"><a href="particle-swarm-optimization-pso.html#cb26-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dmat =</span> mat<span class="sc">$</span>Dmat, <span class="at">dvec =</span> mat<span class="sc">$</span>dvec, </span>
<span id="cb26-39"><a href="particle-swarm-optimization-pso.html#cb26-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amat =</span> mat<span class="sc">$</span>Amat, <span class="at">bvec =</span> mat<span class="sc">$</span>bvec, <span class="at">meq =</span> mat<span class="sc">$</span>meq</span>
<span id="cb26-40"><a href="particle-swarm-optimization-pso.html#cb26-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-41"><a href="particle-swarm-optimization-pso.html#cb26-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-42"><a href="particle-swarm-optimization-pso.html#cb26-42" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-43"><a href="particle-swarm-optimization-pso.html#cb26-43" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mu&quot;</span> <span class="ot">=</span> mu <span class="sc">%*%</span> qp<span class="sc">$</span>solution,</span>
<span id="cb26-44"><a href="particle-swarm-optimization-pso.html#cb26-44" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="fu">t</span>(qp<span class="sc">$</span>solution) <span class="sc">%*%</span> cov <span class="sc">%*%</span> qp<span class="sc">$</span>solution,</span>
<span id="cb26-45"><a href="particle-swarm-optimization-pso.html#cb26-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;composition&quot;</span> <span class="ot">=</span> <span class="fu">setNames</span>(qp<span class="sc">$</span>solution, <span class="fu">colnames</span>(returns))</span>
<span id="cb26-46"><a href="particle-swarm-optimization-pso.html#cb26-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-47"><a href="particle-swarm-optimization-pso.html#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span></span>
<span id="cb26-48"><a href="particle-swarm-optimization-pso.html#cb26-48" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e){<span class="cn">FALSE</span>})</span>
<span id="cb26-49"><a href="particle-swarm-optimization-pso.html#cb26-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-50"><a href="particle-swarm-optimization-pso.html#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="particle-swarm-optimization-pso.html#cb26-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tc){</span>
<span id="cb26-52"><a href="particle-swarm-optimization-pso.html#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb26-53"><a href="particle-swarm-optimization-pso.html#cb26-53" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb26-54"><a href="particle-swarm-optimization-pso.html#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb26-55"><a href="particle-swarm-optimization-pso.html#cb26-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mu&quot;</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb26-56"><a href="particle-swarm-optimization-pso.html#cb26-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb26-57"><a href="particle-swarm-optimization-pso.html#cb26-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;composition&quot;</span> <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb26-58"><a href="particle-swarm-optimization-pso.html#cb26-58" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb26-59"><a href="particle-swarm-optimization-pso.html#cb26-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-60"><a href="particle-swarm-optimization-pso.html#cb26-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-61"><a href="particle-swarm-optimization-pso.html#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="particle-swarm-optimization-pso.html#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="particle-swarm-optimization-pso.html#cb26-63" aria-hidden="true" tabindex="-1"></a>mvp_PSO <span class="ot">&lt;-</span> <span class="cf">function</span>(returns, lambda, <span class="at">silent =</span> T){</span>
<span id="cb26-64"><a href="particle-swarm-optimization-pso.html#cb26-64" aria-hidden="true" tabindex="-1"></a>  tc <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb26-65"><a href="particle-swarm-optimization-pso.html#cb26-65" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">ret_to_geomeanret</span>(returns)</span>
<span id="cb26-66"><a href="particle-swarm-optimization-pso.html#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="particle-swarm-optimization-pso.html#cb26-67" aria-hidden="true" tabindex="-1"></a>    cov <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">nearPD</span>(<span class="fu">cov</span>(returns))<span class="sc">$</span>mat)</span>
<span id="cb26-68"><a href="particle-swarm-optimization-pso.html#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-69"><a href="particle-swarm-optimization-pso.html#cb26-69" aria-hidden="true" tabindex="-1"></a>    mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-70"><a href="particle-swarm-optimization-pso.html#cb26-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dmat =</span> lambda <span class="sc">*</span> cov,</span>
<span id="cb26-71"><a href="particle-swarm-optimization-pso.html#cb26-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">dvec =</span> (<span class="dv">1</span><span class="sc">-</span>lambda) <span class="sc">*</span> mu,</span>
<span id="cb26-72"><a href="particle-swarm-optimization-pso.html#cb26-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb26-73"><a href="particle-swarm-optimization-pso.html#cb26-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(returns)), <span class="co"># sum up to 1</span></span>
<span id="cb26-74"><a href="particle-swarm-optimization-pso.html#cb26-74" aria-hidden="true" tabindex="-1"></a>        <span class="fu">diag</span>(<span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">ncol</span>(returns), <span class="at">ncol=</span><span class="fu">ncol</span>(returns)) <span class="co"># long only</span></span>
<span id="cb26-75"><a href="particle-swarm-optimization-pso.html#cb26-75" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb26-76"><a href="particle-swarm-optimization-pso.html#cb26-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb26-77"><a href="particle-swarm-optimization-pso.html#cb26-77" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb26-78"><a href="particle-swarm-optimization-pso.html#cb26-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(returns)) <span class="co"># long only</span></span>
<span id="cb26-79"><a href="particle-swarm-optimization-pso.html#cb26-79" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb26-80"><a href="particle-swarm-optimization-pso.html#cb26-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb26-81"><a href="particle-swarm-optimization-pso.html#cb26-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-82"><a href="particle-swarm-optimization-pso.html#cb26-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-83"><a href="particle-swarm-optimization-pso.html#cb26-83" aria-hidden="true" tabindex="-1"></a>    calc_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb26-84"><a href="particle-swarm-optimization-pso.html#cb26-84" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat <span class="sc">%*%</span> x <span class="sc">-</span> <span class="fu">t</span>(mat<span class="sc">$</span>dvec) <span class="sc">%*%</span> x</span>
<span id="cb26-85"><a href="particle-swarm-optimization-pso.html#cb26-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-86"><a href="particle-swarm-optimization-pso.html#cb26-86" aria-hidden="true" tabindex="-1"></a>    calc_const <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb26-87"><a href="particle-swarm-optimization-pso.html#cb26-87" aria-hidden="true" tabindex="-1"></a>      const <span class="ot">&lt;-</span> <span class="fu">t</span>(mat<span class="sc">$</span>Amat) <span class="sc">%*%</span> x <span class="sc">-</span> mat<span class="sc">$</span>bvec</span>
<span id="cb26-88"><a href="particle-swarm-optimization-pso.html#cb26-88" aria-hidden="true" tabindex="-1"></a>      const[mat<span class="sc">$</span>meq] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">max</span>(<span class="dv">0</span>, <span class="fu">abs</span>(const[mat<span class="sc">$</span>meq])<span class="sc">-</span><span class="fl">0.01</span>)</span>
<span id="cb26-89"><a href="particle-swarm-optimization-pso.html#cb26-89" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">min</span>(<span class="dv">0</span>, const))</span>
<span id="cb26-90"><a href="particle-swarm-optimization-pso.html#cb26-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-91"><a href="particle-swarm-optimization-pso.html#cb26-91" aria-hidden="true" tabindex="-1"></a>    pso_res <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb26-92"><a href="particle-swarm-optimization-pso.html#cb26-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">par =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">ncol</span>(returns)),</span>
<span id="cb26-93"><a href="particle-swarm-optimization-pso.html#cb26-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb26-94"><a href="particle-swarm-optimization-pso.html#cb26-94" aria-hidden="true" tabindex="-1"></a>        fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb26-95"><a href="particle-swarm-optimization-pso.html#cb26-95" aria-hidden="true" tabindex="-1"></a>        constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb26-96"><a href="particle-swarm-optimization-pso.html#cb26-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(fitness <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> constraints)</span>
<span id="cb26-97"><a href="particle-swarm-optimization-pso.html#cb26-97" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb26-98"><a href="particle-swarm-optimization-pso.html#cb26-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb26-99"><a href="particle-swarm-optimization-pso.html#cb26-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="dv">1</span>,</span>
<span id="cb26-100"><a href="particle-swarm-optimization-pso.html#cb26-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb26-101"><a href="particle-swarm-optimization-pso.html#cb26-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> <span class="dv">300</span>, <span class="co"># swarm size</span></span>
<span id="cb26-102"><a href="particle-swarm-optimization-pso.html#cb26-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb26-103"><a href="particle-swarm-optimization-pso.html#cb26-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb26-104"><a href="particle-swarm-optimization-pso.html#cb26-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">maxiter =</span> <span class="dv">200</span>, <span class="co"># iterations</span></span>
<span id="cb26-105"><a href="particle-swarm-optimization-pso.html#cb26-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb26-106"><a href="particle-swarm-optimization-pso.html#cb26-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb26-107"><a href="particle-swarm-optimization-pso.html#cb26-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb26-108"><a href="particle-swarm-optimization-pso.html#cb26-108" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb26-109"><a href="particle-swarm-optimization-pso.html#cb26-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-110"><a href="particle-swarm-optimization-pso.html#cb26-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span>silent){</span>
<span id="cb26-111"><a href="particle-swarm-optimization-pso.html#cb26-111" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p0</span>(<span class="st">&quot;constraint: &quot;</span>, <span class="fu">sum</span>(<span class="fu">calc_const</span>(pso_res<span class="sc">$</span>solution)))</span>
<span id="cb26-112"><a href="particle-swarm-optimization-pso.html#cb26-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">p0</span>(<span class="st">&quot;fitness: &quot;</span>, <span class="fu">calc_fit</span>(pso_res<span class="sc">$</span>solution))</span>
<span id="cb26-113"><a href="particle-swarm-optimization-pso.html#cb26-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-114"><a href="particle-swarm-optimization-pso.html#cb26-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-115"><a href="particle-swarm-optimization-pso.html#cb26-115" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-116"><a href="particle-swarm-optimization-pso.html#cb26-116" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mu&quot;</span> <span class="ot">=</span> mu <span class="sc">%*%</span> pso_res<span class="sc">$</span>solution,</span>
<span id="cb26-117"><a href="particle-swarm-optimization-pso.html#cb26-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="fu">t</span>(pso_res<span class="sc">$</span>solution) <span class="sc">%*%</span> cov <span class="sc">%*%</span> pso_res<span class="sc">$</span>solution,</span>
<span id="cb26-118"><a href="particle-swarm-optimization-pso.html#cb26-118" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;composition&quot;</span> <span class="ot">=</span> <span class="fu">setNames</span>(pso_res<span class="sc">$</span>solution, <span class="fu">colnames</span>(returns)),</span>
<span id="cb26-119"><a href="particle-swarm-optimization-pso.html#cb26-119" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;fit&quot;</span> <span class="ot">=</span> <span class="fu">calc_fit</span>(pso_res<span class="sc">$</span>solution),</span>
<span id="cb26-120"><a href="particle-swarm-optimization-pso.html#cb26-120" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;constraint&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">calc_const</span>(pso_res<span class="sc">$</span>solution))</span>
<span id="cb26-121"><a href="particle-swarm-optimization-pso.html#cb26-121" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-122"><a href="particle-swarm-optimization-pso.html#cb26-122" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span></span>
<span id="cb26-123"><a href="particle-swarm-optimization-pso.html#cb26-123" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e){<span class="cn">FALSE</span>})</span>
<span id="cb26-124"><a href="particle-swarm-optimization-pso.html#cb26-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-125"><a href="particle-swarm-optimization-pso.html#cb26-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-126"><a href="particle-swarm-optimization-pso.html#cb26-126" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(tc){</span>
<span id="cb26-127"><a href="particle-swarm-optimization-pso.html#cb26-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb26-128"><a href="particle-swarm-optimization-pso.html#cb26-128" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb26-129"><a href="particle-swarm-optimization-pso.html#cb26-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb26-130"><a href="particle-swarm-optimization-pso.html#cb26-130" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;mu&quot;</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb26-131"><a href="particle-swarm-optimization-pso.html#cb26-131" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb26-132"><a href="particle-swarm-optimization-pso.html#cb26-132" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;composition&quot;</span> <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb26-133"><a href="particle-swarm-optimization-pso.html#cb26-133" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb26-134"><a href="particle-swarm-optimization-pso.html#cb26-134" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-135"><a href="particle-swarm-optimization-pso.html#cb26-135" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-136"><a href="particle-swarm-optimization-pso.html#cb26-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-137"><a href="particle-swarm-optimization-pso.html#cb26-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-138"><a href="particle-swarm-optimization-pso.html#cb26-138" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-139"><a href="particle-swarm-optimization-pso.html#cb26-139" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb26-140"><a href="particle-swarm-optimization-pso.html#cb26-140" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">round</span>((runs<span class="dv">-1</span>)<span class="sc">/</span><span class="dv">2</span>)){</span>
<span id="cb26-141"><a href="particle-swarm-optimization-pso.html#cb26-141" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>i<span class="sc">/</span>runs</span>
<span id="cb26-142"><a href="particle-swarm-optimization-pso.html#cb26-142" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">mvp_QP</span>(<span class="at">returns =</span> returns_raw, <span class="at">lambda =</span> lambda)</span>
<span id="cb26-143"><a href="particle-swarm-optimization-pso.html#cb26-143" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, <span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span><span class="ot">=</span><span class="st">&quot;QP_MVP&quot;</span>, <span class="st">&quot;lambda&quot;</span><span class="ot">=</span>lambda, <span class="st">&quot;mu&quot;</span><span class="ot">=</span>temp<span class="sc">$</span>mu, <span class="st">&quot;var&quot;</span><span class="ot">=</span>temp<span class="sc">$</span>var, <span class="st">&quot;constraint&quot;</span><span class="ot">=</span><span class="dv">0</span>))</span>
<span id="cb26-144"><a href="particle-swarm-optimization-pso.html#cb26-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-145"><a href="particle-swarm-optimization-pso.html#cb26-145" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">mvp_PSO</span>(<span class="at">returns =</span> returns_raw, <span class="at">lambda =</span> lambda)</span>
<span id="cb26-146"><a href="particle-swarm-optimization-pso.html#cb26-146" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, <span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span><span class="ot">=</span><span class="st">&quot;PSO_MVP&quot;</span>, <span class="st">&quot;lambda&quot;</span><span class="ot">=</span>lambda, <span class="st">&quot;mu&quot;</span><span class="ot">=</span>temp<span class="sc">$</span>mu, <span class="st">&quot;var&quot;</span><span class="ot">=</span>temp<span class="sc">$</span>var, <span class="st">&quot;constraint&quot;</span><span class="ot">=</span>temp<span class="sc">$</span>constraint))</span>
<span id="cb26-147"><a href="particle-swarm-optimization-pso.html#cb26-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-148"><a href="particle-swarm-optimization-pso.html#cb26-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-149"><a href="particle-swarm-optimization-pso.html#cb26-149" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sd <span class="ot">=</span> <span class="fu">sqrt</span>(df<span class="sc">$</span>var)</span>
<span id="cb26-150"><a href="particle-swarm-optimization-pso.html#cb26-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-151"><a href="particle-swarm-optimization-pso.html#cb26-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-152"><a href="particle-swarm-optimization-pso.html#cb26-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-153"><a href="particle-swarm-optimization-pso.html#cb26-153" aria-hidden="true" tabindex="-1"></a>df_qp <span class="ot">&lt;-</span> df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;QP_MVP&quot;</span> <span class="sc">&amp;</span> df<span class="sc">$</span>lambda <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fl">0.8</span>,<span class="sc">-</span><span class="fl">0.1</span>),]</span>
<span id="cb26-154"><a href="particle-swarm-optimization-pso.html#cb26-154" aria-hidden="true" tabindex="-1"></a>df_diff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-155"><a href="particle-swarm-optimization-pso.html#cb26-155" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;mu_pso&quot;</span> <span class="ot">=</span> df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;PSO_MVP&quot;</span>,]<span class="sc">$</span>mu,</span>
<span id="cb26-156"><a href="particle-swarm-optimization-pso.html#cb26-156" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sd_pso&quot;</span> <span class="ot">=</span> df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;PSO_MVP&quot;</span>,]<span class="sc">$</span>sd,</span>
<span id="cb26-157"><a href="particle-swarm-optimization-pso.html#cb26-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;mu_qp&quot;</span> <span class="ot">=</span> df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;QP_MVP&quot;</span>,]<span class="sc">$</span>mu,</span>
<span id="cb26-158"><a href="particle-swarm-optimization-pso.html#cb26-158" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sd_qp&quot;</span> <span class="ot">=</span> df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;QP_MVP&quot;</span>,]<span class="sc">$</span>sd</span>
<span id="cb26-159"><a href="particle-swarm-optimization-pso.html#cb26-159" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-160"><a href="particle-swarm-optimization-pso.html#cb26-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-161"><a href="particle-swarm-optimization-pso.html#cb26-161" aria-hidden="true" tabindex="-1"></a>shapes <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb26-162"><a href="particle-swarm-optimization-pso.html#cb26-162" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_diff)){</span>
<span id="cb26-163"><a href="particle-swarm-optimization-pso.html#cb26-163" aria-hidden="true" tabindex="-1"></a>  shapes[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb26-164"><a href="particle-swarm-optimization-pso.html#cb26-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;line&quot;</span>, </span>
<span id="cb26-165"><a href="particle-swarm-optimization-pso.html#cb26-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">y0 =</span> df_diff[i,]<span class="sc">$</span>mu_pso, </span>
<span id="cb26-166"><a href="particle-swarm-optimization-pso.html#cb26-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">y1 =</span> df_diff[i,]<span class="sc">$</span>mu_qp, </span>
<span id="cb26-167"><a href="particle-swarm-optimization-pso.html#cb26-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">yref =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb26-168"><a href="particle-swarm-optimization-pso.html#cb26-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">xref =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb26-169"><a href="particle-swarm-optimization-pso.html#cb26-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">x0 =</span> df_diff[i,]<span class="sc">$</span>sd_pso, </span>
<span id="cb26-170"><a href="particle-swarm-optimization-pso.html#cb26-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">x1 =</span> df_diff[i,]<span class="sc">$</span>sd_qp, </span>
<span id="cb26-171"><a href="particle-swarm-optimization-pso.html#cb26-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">&quot;lightgrey&quot;</span>),</span>
<span id="cb26-172"><a href="particle-swarm-optimization-pso.html#cb26-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">layer=</span><span class="st">&#39;below&#39;</span></span>
<span id="cb26-173"><a href="particle-swarm-optimization-pso.html#cb26-173" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-174"><a href="particle-swarm-optimization-pso.html#cb26-174" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-175"><a href="particle-swarm-optimization-pso.html#cb26-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-176"><a href="particle-swarm-optimization-pso.html#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-177"><a href="particle-swarm-optimization-pso.html#cb26-177" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb26-178"><a href="particle-swarm-optimization-pso.html#cb26-178" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df, </span>
<span id="cb26-179"><a href="particle-swarm-optimization-pso.html#cb26-179" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="sc">~</span>sd, </span>
<span id="cb26-180"><a href="particle-swarm-optimization-pso.html#cb26-180" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span><span class="sc">~</span>mu, </span>
<span id="cb26-181"><a href="particle-swarm-optimization-pso.html#cb26-181" aria-hidden="true" tabindex="-1"></a>  <span class="at">name=</span><span class="sc">~</span>type, </span>
<span id="cb26-182"><a href="particle-swarm-optimization-pso.html#cb26-182" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode=</span><span class="st">&quot;markers&quot;</span>, </span>
<span id="cb26-183"><a href="particle-swarm-optimization-pso.html#cb26-183" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, </span>
<span id="cb26-184"><a href="particle-swarm-optimization-pso.html#cb26-184" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="sc">~</span>type, </span>
<span id="cb26-185"><a href="particle-swarm-optimization-pso.html#cb26-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb26-186"><a href="particle-swarm-optimization-pso.html#cb26-186" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-187"><a href="particle-swarm-optimization-pso.html#cb26-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_annotations</span>(</span>
<span id="cb26-188"><a href="particle-swarm-optimization-pso.html#cb26-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>df_qp,   </span>
<span id="cb26-189"><a href="particle-swarm-optimization-pso.html#cb26-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="sc">~</span>sd, </span>
<span id="cb26-190"><a href="particle-swarm-optimization-pso.html#cb26-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="sc">~</span>mu, </span>
<span id="cb26-191"><a href="particle-swarm-optimization-pso.html#cb26-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">&quot;lambda: &quot;</span>,lambda),</span>
<span id="cb26-192"><a href="particle-swarm-optimization-pso.html#cb26-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">ay =</span> <span class="sc">-</span><span class="dv">30</span>,</span>
<span id="cb26-193"><a href="particle-swarm-optimization-pso.html#cb26-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">ax =</span> <span class="sc">-</span><span class="dv">30</span></span>
<span id="cb26-194"><a href="particle-swarm-optimization-pso.html#cb26-194" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-195"><a href="particle-swarm-optimization-pso.html#cb26-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add_segments(</span></span>
<span id="cb26-196"><a href="particle-swarm-optimization-pso.html#cb26-196" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   #data=df_diff,   </span></span>
<span id="cb26-197"><a href="particle-swarm-optimization-pso.html#cb26-197" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   x=df_diff$sd_pso, </span></span>
<span id="cb26-198"><a href="particle-swarm-optimization-pso.html#cb26-198" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   y=df_diff$mu_pso, </span></span>
<span id="cb26-199"><a href="particle-swarm-optimization-pso.html#cb26-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   yend = df_diff$sd_diff,</span></span>
<span id="cb26-200"><a href="particle-swarm-optimization-pso.html#cb26-200" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   xend = df_diff$mu_diff</span></span>
<span id="cb26-201"><a href="particle-swarm-optimization-pso.html#cb26-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb26-202"><a href="particle-swarm-optimization-pso.html#cb26-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb26-203"><a href="particle-swarm-optimization-pso.html#cb26-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis=</span><span class="fu">list</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="fl">0.5</span><span class="sc">*</span><span class="fu">min</span>(df<span class="sc">$</span>sd), <span class="fl">1.2</span><span class="sc">*</span><span class="fu">max</span>(df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;QP_MVP&quot;</span>,]<span class="sc">$</span>sd)), <span class="at">showgrid =</span> <span class="cn">FALSE</span>),</span>
<span id="cb26-204"><a href="particle-swarm-optimization-pso.html#cb26-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="fl">0.5</span><span class="sc">*</span><span class="fu">min</span>(df<span class="sc">$</span>mu), <span class="fl">1.2</span><span class="sc">*</span><span class="fu">max</span>(df[df<span class="sc">$</span>type<span class="sc">==</span><span class="st">&quot;QP_MVP&quot;</span>,]<span class="sc">$</span>mu)), <span class="at">showgrid =</span> <span class="cn">FALSE</span>),</span>
<span id="cb26-205"><a href="particle-swarm-optimization-pso.html#cb26-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">shapes =</span> shapes,</span>
<span id="cb26-206"><a href="particle-swarm-optimization-pso.html#cb26-206" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">0.1</span>, <span class="at">y =</span> <span class="fl">0.9</span>)</span>
<span id="cb26-207"><a href="particle-swarm-optimization-pso.html#cb26-207" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-208"><a href="particle-swarm-optimization-pso.html#cb26-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>()</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/pso7-1.png" width="672" /></p>
<p>The dots for each <span class="math inline">\(\lambda\)</span> are connected with a grey line to visualize the error of the PSO. It can be seen that its possible to solve MVP’s with a PSO approach.</p>
</div>
<div id="example-itp-mste" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Example: ITP-MSTE<a href="particle-swarm-optimization-pso.html#example-itp-mste" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The same ITP-MSTE solved with <code>solve.QP()</code> in <a href="analytic-solver-for-quadratic-programming-problems.html#exampleitpsolveqp">6.4</a> is used as the benchmark for the PSO. In summary, the goal is to create a portfolio that minimizes the mean square error of the returns of itself and the S&amp;P 500 between 2018-01-01 and 2019-12-31. The pool of assets includes all assets that are present in 2019-12-31 and have no missing values. The constraints are long only and the weights should sum to one. The parameters for the PSO are a swarm size of 100, 100 iterations, the inertia weight starts at <span class="math inline">\(1.2\)</span>, the upper bound is <span class="math inline">\(0.1\)</span>, and a starting position is the zero vector. The PSO was run ten times, and the aggregated best and mean runs are compared to the <code>solve.QP()</code> approach for seed 0 in the table below:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb27-1"><a href="particle-swarm-optimization-pso.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb27-2"><a href="particle-swarm-optimization-pso.html#cb27-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb27-3"><a href="particle-swarm-optimization-pso.html#cb27-3" aria-hidden="true" tabindex="-1"></a>from <span class="ot">&lt;-</span> <span class="st">&quot;2018-01-01&quot;</span></span>
<span id="cb27-4"><a href="particle-swarm-optimization-pso.html#cb27-4" aria-hidden="true" tabindex="-1"></a>to <span class="ot">&lt;-</span> <span class="st">&quot;2019-12-31&quot;</span></span>
<span id="cb27-5"><a href="particle-swarm-optimization-pso.html#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="particle-swarm-optimization-pso.html#cb27-6" aria-hidden="true" tabindex="-1"></a>spx_composition <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb27-7"><a href="particle-swarm-optimization-pso.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_spx_composition</span>(),</span>
<span id="cb27-8"><a href="particle-swarm-optimization-pso.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_spx_composition&quot;</span></span>
<span id="cb27-9"><a href="particle-swarm-optimization-pso.html#cb27-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-10"><a href="particle-swarm-optimization-pso.html#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="particle-swarm-optimization-pso.html#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="particle-swarm-optimization-pso.html#cb27-12" aria-hidden="true" tabindex="-1"></a>pool_returns_raw <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb27-13"><a href="particle-swarm-optimization-pso.html#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(</span>
<span id="cb27-14"><a href="particle-swarm-optimization-pso.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tickers =</span> spx_composition <span class="sc">%&gt;%</span> </span>
<span id="cb27-15"><a href="particle-swarm-optimization-pso.html#cb27-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>to) <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="particle-swarm-optimization-pso.html#cb27-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">==</span><span class="fu">max</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="particle-swarm-optimization-pso.html#cb27-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(Ticker), </span>
<span id="cb27-18"><a href="particle-swarm-optimization-pso.html#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> from, </span>
<span id="cb27-19"><a href="particle-swarm-optimization-pso.html#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> to</span>
<span id="cb27-20"><a href="particle-swarm-optimization-pso.html#cb27-20" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>returns, </span>
<span id="cb27-21"><a href="particle-swarm-optimization-pso.html#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500_assets&quot;</span></span>
<span id="cb27-22"><a href="particle-swarm-optimization-pso.html#cb27-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-23"><a href="particle-swarm-optimization-pso.html#cb27-23" aria-hidden="true" tabindex="-1"></a>pool_returns_raw <span class="ot">&lt;-</span> </span>
<span id="cb27-24"><a href="particle-swarm-optimization-pso.html#cb27-24" aria-hidden="true" tabindex="-1"></a>  pool_returns_raw[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(pool_returns_raw))<span class="sc">==</span><span class="dv">0</span>]</span>
<span id="cb27-25"><a href="particle-swarm-optimization-pso.html#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="particle-swarm-optimization-pso.html#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="particle-swarm-optimization-pso.html#cb27-27" aria-hidden="true" tabindex="-1"></a>bm_returns <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb27-28"><a href="particle-swarm-optimization-pso.html#cb27-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(<span class="at">tickers =</span> <span class="st">&quot;%5EGSPC&quot;</span>, <span class="at">from =</span> from, <span class="at">to =</span> to)<span class="sc">$</span>returns, </span>
<span id="cb27-29"><a href="particle-swarm-optimization-pso.html#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500&quot;</span></span>
<span id="cb27-30"><a href="particle-swarm-optimization-pso.html#cb27-30" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(., <span class="st">&quot;S&amp;P 500&quot;</span>)</span>
<span id="cb27-31"><a href="particle-swarm-optimization-pso.html#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="particle-swarm-optimization-pso.html#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="particle-swarm-optimization-pso.html#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="particle-swarm-optimization-pso.html#cb27-34" aria-hidden="true" tabindex="-1"></a>itp_QP <span class="ot">&lt;-</span> <span class="cf">function</span>(pool_returns, bm_returns){</span>
<span id="cb27-35"><a href="particle-swarm-optimization-pso.html#cb27-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-36"><a href="particle-swarm-optimization-pso.html#cb27-36" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-37"><a href="particle-swarm-optimization-pso.html#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dmat =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> pool_returns,</span>
<span id="cb27-38"><a href="particle-swarm-optimization-pso.html#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">dvec =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb27-39"><a href="particle-swarm-optimization-pso.html#cb27-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb27-40"><a href="particle-swarm-optimization-pso.html#cb27-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_returns)), <span class="co"># sum up to 1</span></span>
<span id="cb27-41"><a href="particle-swarm-optimization-pso.html#cb27-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb27-42"><a href="particle-swarm-optimization-pso.html#cb27-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow=</span><span class="fu">ncol</span>(pool_returns), </span>
<span id="cb27-43"><a href="particle-swarm-optimization-pso.html#cb27-43" aria-hidden="true" tabindex="-1"></a>           <span class="at">ncol=</span><span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb27-44"><a href="particle-swarm-optimization-pso.html#cb27-44" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb27-45"><a href="particle-swarm-optimization-pso.html#cb27-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb27-46"><a href="particle-swarm-optimization-pso.html#cb27-46" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb27-47"><a href="particle-swarm-optimization-pso.html#cb27-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb27-48"><a href="particle-swarm-optimization-pso.html#cb27-48" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-49"><a href="particle-swarm-optimization-pso.html#cb27-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb27-50"><a href="particle-swarm-optimization-pso.html#cb27-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-51"><a href="particle-swarm-optimization-pso.html#cb27-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-52"><a href="particle-swarm-optimization-pso.html#cb27-52" aria-hidden="true" tabindex="-1"></a>  qp <span class="ot">&lt;-</span> <span class="fu">solve.QP</span>(</span>
<span id="cb27-53"><a href="particle-swarm-optimization-pso.html#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dmat =</span> mat<span class="sc">$</span>Dmat, <span class="at">dvec =</span> mat<span class="sc">$</span>dvec, </span>
<span id="cb27-54"><a href="particle-swarm-optimization-pso.html#cb27-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amat =</span> mat<span class="sc">$</span>Amat, <span class="at">bvec =</span> mat<span class="sc">$</span>bvec, <span class="at">meq =</span> mat<span class="sc">$</span>meq</span>
<span id="cb27-55"><a href="particle-swarm-optimization-pso.html#cb27-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-56"><a href="particle-swarm-optimization-pso.html#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="particle-swarm-optimization-pso.html#cb27-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-58"><a href="particle-swarm-optimization-pso.html#cb27-58" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-59"><a href="particle-swarm-optimization-pso.html#cb27-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;value&quot;</span> <span class="ot">=</span> qp<span class="sc">$</span>value,</span>
<span id="cb27-60"><a href="particle-swarm-optimization-pso.html#cb27-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb27-61"><a href="particle-swarm-optimization-pso.html#cb27-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">var</span>(pool_returns <span class="sc">%*%</span> qp<span class="sc">$</span>solution <span class="sc">-</span> bm_returns)),</span>
<span id="cb27-62"><a href="particle-swarm-optimization-pso.html#cb27-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;solution&quot;</span> <span class="ot">=</span> <span class="fu">setNames</span>(qp<span class="sc">$</span>solution, <span class="fu">colnames</span>(pool_returns))</span>
<span id="cb27-63"><a href="particle-swarm-optimization-pso.html#cb27-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-64"><a href="particle-swarm-optimization-pso.html#cb27-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-65"><a href="particle-swarm-optimization-pso.html#cb27-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-66"><a href="particle-swarm-optimization-pso.html#cb27-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-67"><a href="particle-swarm-optimization-pso.html#cb27-67" aria-hidden="true" tabindex="-1"></a>itp_PSO <span class="ot">&lt;-</span> <span class="cf">function</span>(pool_returns, bm_returns, <span class="at">silent =</span> T){</span>
<span id="cb27-68"><a href="particle-swarm-optimization-pso.html#cb27-68" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-69"><a href="particle-swarm-optimization-pso.html#cb27-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dmat =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> pool_returns,</span>
<span id="cb27-70"><a href="particle-swarm-optimization-pso.html#cb27-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">dvec =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb27-71"><a href="particle-swarm-optimization-pso.html#cb27-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb27-72"><a href="particle-swarm-optimization-pso.html#cb27-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_returns)), <span class="co"># sum up to 1</span></span>
<span id="cb27-73"><a href="particle-swarm-optimization-pso.html#cb27-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb27-74"><a href="particle-swarm-optimization-pso.html#cb27-74" aria-hidden="true" tabindex="-1"></a>           <span class="at">nrow=</span><span class="fu">ncol</span>(pool_returns), </span>
<span id="cb27-75"><a href="particle-swarm-optimization-pso.html#cb27-75" aria-hidden="true" tabindex="-1"></a>           <span class="at">ncol=</span><span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb27-76"><a href="particle-swarm-optimization-pso.html#cb27-76" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb27-77"><a href="particle-swarm-optimization-pso.html#cb27-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb27-78"><a href="particle-swarm-optimization-pso.html#cb27-78" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb27-79"><a href="particle-swarm-optimization-pso.html#cb27-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb27-80"><a href="particle-swarm-optimization-pso.html#cb27-80" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-81"><a href="particle-swarm-optimization-pso.html#cb27-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb27-82"><a href="particle-swarm-optimization-pso.html#cb27-82" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-83"><a href="particle-swarm-optimization-pso.html#cb27-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-84"><a href="particle-swarm-optimization-pso.html#cb27-84" aria-hidden="true" tabindex="-1"></a>  calc_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-85"><a href="particle-swarm-optimization-pso.html#cb27-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat <span class="sc">%*%</span> x <span class="sc">-</span> <span class="fu">t</span>(mat<span class="sc">$</span>dvec) <span class="sc">%*%</span> x)</span>
<span id="cb27-86"><a href="particle-swarm-optimization-pso.html#cb27-86" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-87"><a href="particle-swarm-optimization-pso.html#cb27-87" aria-hidden="true" tabindex="-1"></a>  calc_const <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb27-88"><a href="particle-swarm-optimization-pso.html#cb27-88" aria-hidden="true" tabindex="-1"></a>    const <span class="ot">&lt;-</span> <span class="fu">t</span>(mat<span class="sc">$</span>Amat) <span class="sc">%*%</span> x <span class="sc">-</span> mat<span class="sc">$</span>bvec</span>
<span id="cb27-89"><a href="particle-swarm-optimization-pso.html#cb27-89" aria-hidden="true" tabindex="-1"></a>    const[mat<span class="sc">$</span>meq] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">max</span>(<span class="dv">0</span>, <span class="fu">abs</span>(const[mat<span class="sc">$</span>meq])<span class="sc">-</span><span class="fl">0.01</span>)</span>
<span id="cb27-90"><a href="particle-swarm-optimization-pso.html#cb27-90" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fu">min</span>(<span class="dv">0</span>, const)</span>
<span id="cb27-91"><a href="particle-swarm-optimization-pso.html#cb27-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-92"><a href="particle-swarm-optimization-pso.html#cb27-92" aria-hidden="true" tabindex="-1"></a>  pso_res <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb27-93"><a href="particle-swarm-optimization-pso.html#cb27-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)),</span>
<span id="cb27-94"><a href="particle-swarm-optimization-pso.html#cb27-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb27-95"><a href="particle-swarm-optimization-pso.html#cb27-95" aria-hidden="true" tabindex="-1"></a>      fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb27-96"><a href="particle-swarm-optimization-pso.html#cb27-96" aria-hidden="true" tabindex="-1"></a>      constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb27-97"><a href="particle-swarm-optimization-pso.html#cb27-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fitness<span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb27-98"><a href="particle-swarm-optimization-pso.html#cb27-98" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-99"><a href="particle-swarm-optimization-pso.html#cb27-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb27-100"><a href="particle-swarm-optimization-pso.html#cb27-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fl">0.1</span>,</span>
<span id="cb27-101"><a href="particle-swarm-optimization-pso.html#cb27-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb27-102"><a href="particle-swarm-optimization-pso.html#cb27-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> <span class="dv">100</span>, <span class="co"># swarm size</span></span>
<span id="cb27-103"><a href="particle-swarm-optimization-pso.html#cb27-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb27-104"><a href="particle-swarm-optimization-pso.html#cb27-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb27-105"><a href="particle-swarm-optimization-pso.html#cb27-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb27-106"><a href="particle-swarm-optimization-pso.html#cb27-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb27-107"><a href="particle-swarm-optimization-pso.html#cb27-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb27-108"><a href="particle-swarm-optimization-pso.html#cb27-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb27-109"><a href="particle-swarm-optimization-pso.html#cb27-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-110"><a href="particle-swarm-optimization-pso.html#cb27-110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-111"><a href="particle-swarm-optimization-pso.html#cb27-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>silent){</span>
<span id="cb27-112"><a href="particle-swarm-optimization-pso.html#cb27-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p0</span>(<span class="st">&quot;constraint: &quot;</span>, <span class="fu">sum</span>(<span class="fu">calc_const</span>(pso_res<span class="sc">$</span>solution)))</span>
<span id="cb27-113"><a href="particle-swarm-optimization-pso.html#cb27-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">p0</span>(<span class="st">&quot;fitness: &quot;</span>, <span class="fu">calc_fit</span>(pso_res<span class="sc">$</span>solution))</span>
<span id="cb27-114"><a href="particle-swarm-optimization-pso.html#cb27-114" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-115"><a href="particle-swarm-optimization-pso.html#cb27-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-116"><a href="particle-swarm-optimization-pso.html#cb27-116" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb27-117"><a href="particle-swarm-optimization-pso.html#cb27-117" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;composition&quot;</span> <span class="ot">=</span> <span class="fu">setNames</span>(pso_res<span class="sc">$</span>solution, <span class="fu">colnames</span>(pool_returns)),</span>
<span id="cb27-118"><a href="particle-swarm-optimization-pso.html#cb27-118" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fit&quot;</span> <span class="ot">=</span> <span class="fu">calc_fit</span>(pso_res<span class="sc">$</span>solution),</span>
<span id="cb27-119"><a href="particle-swarm-optimization-pso.html#cb27-119" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;constraint&quot;</span> <span class="ot">=</span> <span class="fu">calc_const</span>(pso_res<span class="sc">$</span>solution),</span>
<span id="cb27-120"><a href="particle-swarm-optimization-pso.html#cb27-120" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;var&quot;</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(</span>
<span id="cb27-121"><a href="particle-swarm-optimization-pso.html#cb27-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">var</span>(pool_returns <span class="sc">%*%</span> pso_res<span class="sc">$</span>solution <span class="sc">-</span> bm_returns))</span>
<span id="cb27-122"><a href="particle-swarm-optimization-pso.html#cb27-122" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-123"><a href="particle-swarm-optimization-pso.html#cb27-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-124"><a href="particle-swarm-optimization-pso.html#cb27-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb27-125"><a href="particle-swarm-optimization-pso.html#cb27-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-126"><a href="particle-swarm-optimization-pso.html#cb27-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-127"><a href="particle-swarm-optimization-pso.html#cb27-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-128"><a href="particle-swarm-optimization-pso.html#cb27-128" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-129"><a href="particle-swarm-optimization-pso.html#cb27-129" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(</span>
<span id="cb27-130"><a href="particle-swarm-optimization-pso.html#cb27-130" aria-hidden="true" tabindex="-1"></a>  temp_qp <span class="ot">&lt;-</span> <span class="fu">itp_QP</span>(pool_returns_raw, bm_returns)</span>
<span id="cb27-131"><a href="particle-swarm-optimization-pso.html#cb27-131" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-132"><a href="particle-swarm-optimization-pso.html#cb27-132" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;type&quot;</span><span class="ot">=</span><span class="st">&quot;ITP-MSTE_QP&quot;</span>, <span class="st">&quot;var&quot;</span><span class="ot">=</span>temp_qp<span class="sc">$</span>var, <span class="st">&quot;fitness&quot;</span><span class="ot">=</span>temp_qp<span class="sc">$</span>value, <span class="st">&quot;constraint&quot;</span><span class="ot">=</span><span class="dv">0</span>, <span class="st">&quot;time&quot;</span><span class="ot">=</span>time[<span class="dv">3</span>])</span>
<span id="cb27-133"><a href="particle-swarm-optimization-pso.html#cb27-133" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb27-134"><a href="particle-swarm-optimization-pso.html#cb27-134" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">system.time</span>(</span>
<span id="cb27-135"><a href="particle-swarm-optimization-pso.html#cb27-135" aria-hidden="true" tabindex="-1"></a>    temp_pso <span class="ot">&lt;-</span> <span class="fu">itp_PSO</span>(<span class="at">pool_returns =</span> pool_returns_raw, bm_returns)</span>
<span id="cb27-136"><a href="particle-swarm-optimization-pso.html#cb27-136" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-137"><a href="particle-swarm-optimization-pso.html#cb27-137" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb27-138"><a href="particle-swarm-optimization-pso.html#cb27-138" aria-hidden="true" tabindex="-1"></a>    df, </span>
<span id="cb27-139"><a href="particle-swarm-optimization-pso.html#cb27-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb27-140"><a href="particle-swarm-optimization-pso.html#cb27-140" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;type&quot;</span><span class="ot">=</span><span class="st">&quot;ITP-MSTE_PSO&quot;</span>, </span>
<span id="cb27-141"><a href="particle-swarm-optimization-pso.html#cb27-141" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;var&quot;</span><span class="ot">=</span>temp_pso<span class="sc">$</span>var, </span>
<span id="cb27-142"><a href="particle-swarm-optimization-pso.html#cb27-142" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;fitness&quot;</span><span class="ot">=</span>temp_pso<span class="sc">$</span>fit, </span>
<span id="cb27-143"><a href="particle-swarm-optimization-pso.html#cb27-143" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;constraint&quot;</span><span class="ot">=</span>temp_pso<span class="sc">$</span>constraint, </span>
<span id="cb27-144"><a href="particle-swarm-optimization-pso.html#cb27-144" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;time&quot;</span><span class="ot">=</span>time[<span class="dv">3</span>]</span>
<span id="cb27-145"><a href="particle-swarm-optimization-pso.html#cb27-145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-146"><a href="particle-swarm-optimization-pso.html#cb27-146" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-147"><a href="particle-swarm-optimization-pso.html#cb27-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-148"><a href="particle-swarm-optimization-pso.html#cb27-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-149"><a href="particle-swarm-optimization-pso.html#cb27-149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-150"><a href="particle-swarm-optimization-pso.html#cb27-150" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(df<span class="sc">$</span>var)</span>
<span id="cb27-151"><a href="particle-swarm-optimization-pso.html#cb27-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-152"><a href="particle-swarm-optimization-pso.html#cb27-152" aria-hidden="true" tabindex="-1"></a>df_summary <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb27-153"><a href="particle-swarm-optimization-pso.html#cb27-153" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;ITP-MSTE_QP&quot;</span>),</span>
<span id="cb27-154"><a href="particle-swarm-optimization-pso.html#cb27-154" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;ITP-MSTE_PSO&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(fitness <span class="sc">==</span> <span class="fu">min</span>(fitness)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;ITP-MSTE_PSO_best&quot;</span>),</span>
<span id="cb27-155"><a href="particle-swarm-optimization-pso.html#cb27-155" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;ITP-MSTE_PSO&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> <span class="fu">summarise_all</span>(., mean) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;ITP-MSTE_PSO_mean&quot;</span>)</span>
<span id="cb27-156"><a href="particle-swarm-optimization-pso.html#cb27-156" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-157"><a href="particle-swarm-optimization-pso.html#cb27-157" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-158"><a href="particle-swarm-optimization-pso.html#cb27-158" aria-hidden="true" tabindex="-1"></a>df_summary<span class="sc">$</span>var <span class="ot">&lt;-</span> <span class="fu">round</span>(df_summary<span class="sc">$</span>var, <span class="dv">12</span>)</span>
<span id="cb27-159"><a href="particle-swarm-optimization-pso.html#cb27-159" aria-hidden="true" tabindex="-1"></a>df_summary<span class="sc">$</span>sd <span class="ot">&lt;-</span> <span class="fu">round</span>(df_summary<span class="sc">$</span>sd, <span class="dv">6</span>)</span>
<span id="cb27-160"><a href="particle-swarm-optimization-pso.html#cb27-160" aria-hidden="true" tabindex="-1"></a>df_summary<span class="sc">$</span>fitness <span class="ot">&lt;-</span> <span class="fu">round</span>(df_summary<span class="sc">$</span>fitness, <span class="dv">7</span>)</span>
<span id="cb27-161"><a href="particle-swarm-optimization-pso.html#cb27-161" aria-hidden="true" tabindex="-1"></a>df_summary<span class="sc">$</span>constraint <span class="ot">&lt;-</span> <span class="fu">round</span>(df_summary<span class="sc">$</span>constraint, <span class="dv">18</span>)</span>
<span id="cb27-162"><a href="particle-swarm-optimization-pso.html#cb27-162" aria-hidden="true" tabindex="-1"></a>df_summary<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">round</span>(df_summary<span class="sc">$</span>time, <span class="dv">1</span>)</span>
<span id="cb27-163"><a href="particle-swarm-optimization-pso.html#cb27-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-164"><a href="particle-swarm-optimization-pso.html#cb27-164" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(</span>
<span id="cb27-165"><a href="particle-swarm-optimization-pso.html#cb27-165" aria-hidden="true" tabindex="-1"></a>  df_summary <span class="sc">%&gt;%</span> <span class="fu">select</span>(type, sd, var, fitness, constraint, time),</span>
<span id="cb27-166"><a href="particle-swarm-optimization-pso.html#cb27-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">wrap =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-167"><a href="particle-swarm-optimization-pso.html#cb27-167" aria-hidden="true" tabindex="-1"></a>  <span class="co">#compact = T,</span></span>
<span id="cb27-168"><a href="particle-swarm-optimization-pso.html#cb27-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb27-169"><a href="particle-swarm-optimization-pso.html#cb27-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">colDef</span>(<span class="at">width=</span><span class="dv">180</span>),</span>
<span id="cb27-170"><a href="particle-swarm-optimization-pso.html#cb27-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">var =</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">digits=</span><span class="dv">9</span>), <span class="at">show =</span>F),</span>
<span id="cb27-171"><a href="particle-swarm-optimization-pso.html#cb27-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">digits=</span><span class="dv">5</span>)),</span>
<span id="cb27-172"><a href="particle-swarm-optimization-pso.html#cb27-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">constraint =</span> <span class="fu">colDef</span>(<span class="at">name =</span> <span class="st">&quot;constraint break&quot;</span>)</span>
<span id="cb27-173"><a href="particle-swarm-optimization-pso.html#cb27-173" aria-hidden="true" tabindex="-1"></a>  )<span class="co">#,</span></span>
<span id="cb27-174"><a href="particle-swarm-optimization-pso.html#cb27-174" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme = reactableTheme(style = list(fontFamily = &quot;-apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif&quot;))</span></span>
<span id="cb27-175"><a href="particle-swarm-optimization-pso.html#cb27-175" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-176"><a href="particle-swarm-optimization-pso.html#cb27-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>(., <span class="at">vwidth =</span> <span class="dv">800</span>)</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/pso8-1.png" width="672" /></p>
<p>It can be seen that in all PSO runs, sufficient fitness was achieved with negligible constraint breaks, but much more computation time was required.</p>
</div>
<div id="pros-and-cons-for-continuous-problems" class="section level2 hasAnchor" number="7.6">
<h2><span class="header-section-number">7.6</span> Pros and Cons for Continuous Problems<a href="particle-swarm-optimization-pso.html#pros-and-cons-for-continuous-problems" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A PSO approach has advantages and disadvantages, since on the one hand any problem can theoretically be solved, but it cannot be guaranteed that the solution is also optimal. In addition, the calculations take much longer than with the <code>solve.QP()</code> approach, which raises the question why a PSO approach should have any benefit at all. This is exactly the case, if the solution of the problem is no longer possible by the <code>solve.QP()</code> alone, as it is for example the case with mixed-integer-quadratic-problems. In these types of problems, the condition for <span class="math inline">\(x\)</span> is to be a integer vector. These problems could be solved by the <code>solve.QP()</code> approach only continuously and then rounded. However, this rounding error can become arbitrarily large, which is why the chances of the PSO approach to achieve a better solution are greater than with the <code>solve.QP()</code> approach.</p>
</div>
<div id="discrete-problems-and-transaction-costs" class="section level2 hasAnchor" number="7.7">
<h2><span class="header-section-number">7.7</span> Discrete Problems and Transaction Costs<a href="particle-swarm-optimization-pso.html#discrete-problems-and-transaction-costs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A continuous solution for a portfolio is not sufficient for the practice, because most of the time only integer amounts of assets can be bought. It’s even worse if lot sizes are needed, because these can only be bought in minimum denomination of e.g. ten thousand. Lot sizes are often used in fixed income products. The biggest drawbacks of rounding a continuous solution are the disregarding of conditions and the difference in the objective value, which often cant reach the new optimum. A solution with broken conditions is not acceptable in practice and a <code>solve.QP()</code> approach only produces one solution, which is why its insecure to hope for a sufficient solution after rounding. The PSO doesn’t have these drawbacks and can be easily used for discrete problems by rounding the input of the objective function <code>fn()</code>. In a portfolio with net asset value (<code>nav</code>) consisting of only American stocks with weights <span class="math inline">\(w_i\)</span> and closing prices <span class="math inline">\(p_i\)</span> can be discretized to <span class="math inline">\(w_i^d\)</span> by the following formula:</p>
<p><span class="math display">\[
  w_i^d =\text{round}(w_i \cdot \frac{\text{nav}}{p_i})\cdot \frac{p_i}{\text{nav}}
\]</span></p>
</div>
<div id="example-discrete-itp-mste" class="section level2 hasAnchor" number="7.8">
<h2><span class="header-section-number">7.8</span> Example: Discrete ITP-MSTE<a href="particle-swarm-optimization-pso.html#example-discrete-itp-mste" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This example analyses the error of rounding a solution with the <code>solve.QP()</code> approach and compares it to a discrete PSO. A second discrete PSO is added, that takes the continuous solution of the <code>solve.QP()</code> and uses it as starting position of one particle. The ITP-MSTE focuses to track the S&amp;P 500 with its top 100 weighted assets and tries to construct a portfolio with long only, <span class="math inline">\(1 &lt; \textstyle\sum w_i &gt; 0.99\)</span> and <span class="math inline">\(\text{nav} = 10000\)</span> in the time frame from 2018-01-01 to 2019-12-31. The used prices are closing prices and both PSO’s have 200 particles and 100 iterations. The results can be observed in the table below:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb28-1"><a href="particle-swarm-optimization-pso.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb28-2"><a href="particle-swarm-optimization-pso.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="particle-swarm-optimization-pso.html#cb28-3" aria-hidden="true" tabindex="-1"></a>nav <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb28-4"><a href="particle-swarm-optimization-pso.html#cb28-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-5"><a href="particle-swarm-optimization-pso.html#cb28-5" aria-hidden="true" tabindex="-1"></a>from <span class="ot">&lt;-</span> <span class="st">&quot;2018-01-01&quot;</span></span>
<span id="cb28-6"><a href="particle-swarm-optimization-pso.html#cb28-6" aria-hidden="true" tabindex="-1"></a>to <span class="ot">&lt;-</span> <span class="st">&quot;2019-12-31&quot;</span></span>
<span id="cb28-7"><a href="particle-swarm-optimization-pso.html#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="particle-swarm-optimization-pso.html#cb28-8" aria-hidden="true" tabindex="-1"></a>spx_composition <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb28-9"><a href="particle-swarm-optimization-pso.html#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_spx_composition</span>(),</span>
<span id="cb28-10"><a href="particle-swarm-optimization-pso.html#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_spx_composition&quot;</span></span>
<span id="cb28-11"><a href="particle-swarm-optimization-pso.html#cb28-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-12"><a href="particle-swarm-optimization-pso.html#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="particle-swarm-optimization-pso.html#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="particle-swarm-optimization-pso.html#cb28-14" aria-hidden="true" tabindex="-1"></a>pool_data <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb28-15"><a href="particle-swarm-optimization-pso.html#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(</span>
<span id="cb28-16"><a href="particle-swarm-optimization-pso.html#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">tickers =</span> spx_composition <span class="sc">%&gt;%</span> </span>
<span id="cb28-17"><a href="particle-swarm-optimization-pso.html#cb28-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>to) <span class="sc">%&gt;%</span> </span>
<span id="cb28-18"><a href="particle-swarm-optimization-pso.html#cb28-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">==</span><span class="fu">max</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-19"><a href="particle-swarm-optimization-pso.html#cb28-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(Ticker), </span>
<span id="cb28-20"><a href="particle-swarm-optimization-pso.html#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> from, </span>
<span id="cb28-21"><a href="particle-swarm-optimization-pso.html#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> to</span>
<span id="cb28-22"><a href="particle-swarm-optimization-pso.html#cb28-22" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb28-23"><a href="particle-swarm-optimization-pso.html#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500_asset_data&quot;</span></span>
<span id="cb28-24"><a href="particle-swarm-optimization-pso.html#cb28-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-25"><a href="particle-swarm-optimization-pso.html#cb28-25" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>returns <span class="ot">&lt;-</span> </span>
<span id="cb28-26"><a href="particle-swarm-optimization-pso.html#cb28-26" aria-hidden="true" tabindex="-1"></a>  pool_data<span class="sc">$</span>returns[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(pool_data<span class="sc">$</span>returns))<span class="sc">==</span><span class="dv">0</span>]</span>
<span id="cb28-27"><a href="particle-swarm-optimization-pso.html#cb28-27" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>prices <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>prices[, <span class="fu">colnames</span>(pool_data<span class="sc">$</span>returns)]</span>
<span id="cb28-28"><a href="particle-swarm-optimization-pso.html#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="particle-swarm-optimization-pso.html#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="particle-swarm-optimization-pso.html#cb28-30" aria-hidden="true" tabindex="-1"></a>bm_returns <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb28-31"><a href="particle-swarm-optimization-pso.html#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(<span class="at">tickers =</span> <span class="st">&quot;%5EGSPC&quot;</span>, <span class="at">from =</span> from, <span class="at">to =</span> to)<span class="sc">$</span>returns, </span>
<span id="cb28-32"><a href="particle-swarm-optimization-pso.html#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500&quot;</span></span>
<span id="cb28-33"><a href="particle-swarm-optimization-pso.html#cb28-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(., <span class="st">&quot;S&amp;P 500&quot;</span>)</span>
<span id="cb28-34"><a href="particle-swarm-optimization-pso.html#cb28-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-35"><a href="particle-swarm-optimization-pso.html#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="particle-swarm-optimization-pso.html#cb28-36" aria-hidden="true" tabindex="-1"></a>pool_returns <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>returns</span>
<span id="cb28-37"><a href="particle-swarm-optimization-pso.html#cb28-37" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-38"><a href="particle-swarm-optimization-pso.html#cb28-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> pool_returns,</span>
<span id="cb28-39"><a href="particle-swarm-optimization-pso.html#cb28-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvec =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb28-40"><a href="particle-swarm-optimization-pso.html#cb28-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb28-41"><a href="particle-swarm-optimization-pso.html#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_returns)), <span class="co"># sum up to 1</span></span>
<span id="cb28-42"><a href="particle-swarm-optimization-pso.html#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb28-43"><a href="particle-swarm-optimization-pso.html#cb28-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow=</span><span class="fu">ncol</span>(pool_returns), </span>
<span id="cb28-44"><a href="particle-swarm-optimization-pso.html#cb28-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol=</span><span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb28-45"><a href="particle-swarm-optimization-pso.html#cb28-45" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb28-46"><a href="particle-swarm-optimization-pso.html#cb28-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb28-47"><a href="particle-swarm-optimization-pso.html#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb28-48"><a href="particle-swarm-optimization-pso.html#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb28-49"><a href="particle-swarm-optimization-pso.html#cb28-49" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-50"><a href="particle-swarm-optimization-pso.html#cb28-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb28-51"><a href="particle-swarm-optimization-pso.html#cb28-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-52"><a href="particle-swarm-optimization-pso.html#cb28-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-53"><a href="particle-swarm-optimization-pso.html#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co"># search 100 best tickers</span></span>
<span id="cb28-54"><a href="particle-swarm-optimization-pso.html#cb28-54" aria-hidden="true" tabindex="-1"></a>qp <span class="ot">&lt;-</span> <span class="fu">solve.QP</span>(</span>
<span id="cb28-55"><a href="particle-swarm-optimization-pso.html#cb28-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> mat<span class="sc">$</span>Dmat, <span class="at">dvec =</span> mat<span class="sc">$</span>dvec, </span>
<span id="cb28-56"><a href="particle-swarm-optimization-pso.html#cb28-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> mat<span class="sc">$</span>Amat, <span class="at">bvec =</span> mat<span class="sc">$</span>bvec, <span class="at">meq =</span> mat<span class="sc">$</span>meq</span>
<span id="cb28-57"><a href="particle-swarm-optimization-pso.html#cb28-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-58"><a href="particle-swarm-optimization-pso.html#cb28-58" aria-hidden="true" tabindex="-1"></a>sub_ticker <span class="ot">&lt;-</span> <span class="fu">colnames</span>(pool_returns)[<span class="fu">order</span>(qp<span class="sc">$</span>solution, <span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]]</span>
<span id="cb28-59"><a href="particle-swarm-optimization-pso.html#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="particle-swarm-optimization-pso.html#cb28-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-61"><a href="particle-swarm-optimization-pso.html#cb28-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Default solve.QP</span></span>
<span id="cb28-62"><a href="particle-swarm-optimization-pso.html#cb28-62" aria-hidden="true" tabindex="-1"></a>time_qp <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb28-63"><a href="particle-swarm-optimization-pso.html#cb28-63" aria-hidden="true" tabindex="-1"></a>  res_qp <span class="ot">&lt;-</span> <span class="fu">itp_QP</span>(pool_data<span class="sc">$</span>returns[,sub_ticker], bm_returns)</span>
<span id="cb28-64"><a href="particle-swarm-optimization-pso.html#cb28-64" aria-hidden="true" tabindex="-1"></a>  prices <span class="ot">&lt;-</span> <span class="fu">last</span>(pool_data<span class="sc">$</span>prices[,sub_ticker])</span>
<span id="cb28-65"><a href="particle-swarm-optimization-pso.html#cb28-65" aria-hidden="true" tabindex="-1"></a>  res_qp_discrete <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">as.vector</span>(<span class="fu">round</span>(res_qp<span class="sc">$</span>solution<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav), <span class="fu">names</span>(res_qp<span class="sc">$</span>solution))</span>
<span id="cb28-66"><a href="particle-swarm-optimization-pso.html#cb28-66" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-67"><a href="particle-swarm-optimization-pso.html#cb28-67" aria-hidden="true" tabindex="-1"></a>res_qp_discrete_fit <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(res_qp_discrete) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat[<span class="fu">names</span>(res_qp_discrete), <span class="fu">names</span>(res_qp_discrete)] <span class="sc">%*%</span> res_qp_discrete <span class="sc">-</span> <span class="fu">t</span>(<span class="fu">as.vector</span>(mat<span class="sc">$</span>dvec[<span class="fu">names</span>(res_qp_discrete), ])) <span class="sc">%*%</span> res_qp_discrete)</span>
<span id="cb28-68"><a href="particle-swarm-optimization-pso.html#cb28-68" aria-hidden="true" tabindex="-1"></a>res_qp_discrete_sum_wgt <span class="ot">&lt;-</span> <span class="fu">sum</span>(res_qp_discrete)</span>
<span id="cb28-69"><a href="particle-swarm-optimization-pso.html#cb28-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-70"><a href="particle-swarm-optimization-pso.html#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="particle-swarm-optimization-pso.html#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Default PSO</span></span>
<span id="cb28-72"><a href="particle-swarm-optimization-pso.html#cb28-72" aria-hidden="true" tabindex="-1"></a>pool_returns <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>returns[, sub_ticker]</span>
<span id="cb28-73"><a href="particle-swarm-optimization-pso.html#cb28-73" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-74"><a href="particle-swarm-optimization-pso.html#cb28-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> pool_returns,</span>
<span id="cb28-75"><a href="particle-swarm-optimization-pso.html#cb28-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvec =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb28-76"><a href="particle-swarm-optimization-pso.html#cb28-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb28-77"><a href="particle-swarm-optimization-pso.html#cb28-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_returns)), <span class="co"># sum up to 1</span></span>
<span id="cb28-78"><a href="particle-swarm-optimization-pso.html#cb28-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb28-79"><a href="particle-swarm-optimization-pso.html#cb28-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow=</span><span class="fu">ncol</span>(pool_returns), </span>
<span id="cb28-80"><a href="particle-swarm-optimization-pso.html#cb28-80" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol=</span><span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb28-81"><a href="particle-swarm-optimization-pso.html#cb28-81" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb28-82"><a href="particle-swarm-optimization-pso.html#cb28-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb28-83"><a href="particle-swarm-optimization-pso.html#cb28-83" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb28-84"><a href="particle-swarm-optimization-pso.html#cb28-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb28-85"><a href="particle-swarm-optimization-pso.html#cb28-85" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-86"><a href="particle-swarm-optimization-pso.html#cb28-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb28-87"><a href="particle-swarm-optimization-pso.html#cb28-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-88"><a href="particle-swarm-optimization-pso.html#cb28-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-89"><a href="particle-swarm-optimization-pso.html#cb28-89" aria-hidden="true" tabindex="-1"></a>calc_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb28-90"><a href="particle-swarm-optimization-pso.html#cb28-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat <span class="sc">%*%</span> x <span class="sc">-</span> <span class="fu">t</span>(mat<span class="sc">$</span>dvec) <span class="sc">%*%</span> x)</span>
<span id="cb28-91"><a href="particle-swarm-optimization-pso.html#cb28-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-92"><a href="particle-swarm-optimization-pso.html#cb28-92" aria-hidden="true" tabindex="-1"></a>calc_const <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb28-93"><a href="particle-swarm-optimization-pso.html#cb28-93" aria-hidden="true" tabindex="-1"></a>  const <span class="ot">&lt;-</span> <span class="fu">t</span>(mat<span class="sc">$</span>Amat) <span class="sc">%*%</span> x <span class="sc">-</span> mat<span class="sc">$</span>bvec</span>
<span id="cb28-94"><a href="particle-swarm-optimization-pso.html#cb28-94" aria-hidden="true" tabindex="-1"></a>  const[mat<span class="sc">$</span>meq] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">max</span>(<span class="dv">0</span>, <span class="fu">abs</span>(const[mat<span class="sc">$</span>meq]<span class="sc">+</span><span class="fl">0.01</span>)<span class="sc">-</span><span class="fl">0.01</span>)</span>
<span id="cb28-95"><a href="particle-swarm-optimization-pso.html#cb28-95" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">min</span>(<span class="dv">0</span>, const)</span>
<span id="cb28-96"><a href="particle-swarm-optimization-pso.html#cb28-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-97"><a href="particle-swarm-optimization-pso.html#cb28-97" aria-hidden="true" tabindex="-1"></a>time_pso <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb28-98"><a href="particle-swarm-optimization-pso.html#cb28-98" aria-hidden="true" tabindex="-1"></a>  pso_res <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb28-99"><a href="particle-swarm-optimization-pso.html#cb28-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)),</span>
<span id="cb28-100"><a href="particle-swarm-optimization-pso.html#cb28-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-101"><a href="particle-swarm-optimization-pso.html#cb28-101" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">round</span>(x<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav)</span>
<span id="cb28-102"><a href="particle-swarm-optimization-pso.html#cb28-102" aria-hidden="true" tabindex="-1"></a>      fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb28-103"><a href="particle-swarm-optimization-pso.html#cb28-103" aria-hidden="true" tabindex="-1"></a>      constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb28-104"><a href="particle-swarm-optimization-pso.html#cb28-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fitness <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb28-105"><a href="particle-swarm-optimization-pso.html#cb28-105" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb28-106"><a href="particle-swarm-optimization-pso.html#cb28-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb28-107"><a href="particle-swarm-optimization-pso.html#cb28-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="dv">1</span>,</span>
<span id="cb28-108"><a href="particle-swarm-optimization-pso.html#cb28-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb28-109"><a href="particle-swarm-optimization-pso.html#cb28-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> <span class="dv">200</span>, <span class="co"># swarm size</span></span>
<span id="cb28-110"><a href="particle-swarm-optimization-pso.html#cb28-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb28-111"><a href="particle-swarm-optimization-pso.html#cb28-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb28-112"><a href="particle-swarm-optimization-pso.html#cb28-112" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb28-113"><a href="particle-swarm-optimization-pso.html#cb28-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb28-114"><a href="particle-swarm-optimization-pso.html#cb28-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb28-115"><a href="particle-swarm-optimization-pso.html#cb28-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb28-116"><a href="particle-swarm-optimization-pso.html#cb28-116" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-117"><a href="particle-swarm-optimization-pso.html#cb28-117" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-118"><a href="particle-swarm-optimization-pso.html#cb28-118" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-119"><a href="particle-swarm-optimization-pso.html#cb28-119" aria-hidden="true" tabindex="-1"></a>pso_res<span class="sc">$</span>solution <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">as.vector</span>(<span class="fu">round</span>(pso_res<span class="sc">$</span>solution<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav), <span class="fu">names</span>(res_qp<span class="sc">$</span>solution))</span>
<span id="cb28-120"><a href="particle-swarm-optimization-pso.html#cb28-120" aria-hidden="true" tabindex="-1"></a>res_pso_fit <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(pso_res<span class="sc">$</span>solution) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat[<span class="fu">names</span>(pso_res<span class="sc">$</span>solution), <span class="fu">names</span>(pso_res<span class="sc">$</span>solution)] <span class="sc">%*%</span> pso_res<span class="sc">$</span>solution <span class="sc">-</span> <span class="fu">t</span>(<span class="fu">as.vector</span>(mat<span class="sc">$</span>dvec[<span class="fu">names</span>(pso_res<span class="sc">$</span>solution),])) <span class="sc">%*%</span> pso_res<span class="sc">$</span>solution)</span>
<span id="cb28-121"><a href="particle-swarm-optimization-pso.html#cb28-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-122"><a href="particle-swarm-optimization-pso.html#cb28-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-123"><a href="particle-swarm-optimization-pso.html#cb28-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-124"><a href="particle-swarm-optimization-pso.html#cb28-124" aria-hidden="true" tabindex="-1"></a><span class="co"># PSO with solve.QP starting position</span></span>
<span id="cb28-125"><a href="particle-swarm-optimization-pso.html#cb28-125" aria-hidden="true" tabindex="-1"></a>time_pso_2 <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb28-126"><a href="particle-swarm-optimization-pso.html#cb28-126" aria-hidden="true" tabindex="-1"></a>  pso_2_res <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb28-127"><a href="particle-swarm-optimization-pso.html#cb28-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">par =</span> res_qp<span class="sc">$</span>solution,</span>
<span id="cb28-128"><a href="particle-swarm-optimization-pso.html#cb28-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb28-129"><a href="particle-swarm-optimization-pso.html#cb28-129" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">round</span>(x<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav)</span>
<span id="cb28-130"><a href="particle-swarm-optimization-pso.html#cb28-130" aria-hidden="true" tabindex="-1"></a>      fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb28-131"><a href="particle-swarm-optimization-pso.html#cb28-131" aria-hidden="true" tabindex="-1"></a>      constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb28-132"><a href="particle-swarm-optimization-pso.html#cb28-132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(fitness <span class="sc">+</span> <span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb28-133"><a href="particle-swarm-optimization-pso.html#cb28-133" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb28-134"><a href="particle-swarm-optimization-pso.html#cb28-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb28-135"><a href="particle-swarm-optimization-pso.html#cb28-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="dv">1</span>,</span>
<span id="cb28-136"><a href="particle-swarm-optimization-pso.html#cb28-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb28-137"><a href="particle-swarm-optimization-pso.html#cb28-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">s =</span> <span class="dv">200</span>, <span class="co"># swarm size</span></span>
<span id="cb28-138"><a href="particle-swarm-optimization-pso.html#cb28-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb28-139"><a href="particle-swarm-optimization-pso.html#cb28-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb28-140"><a href="particle-swarm-optimization-pso.html#cb28-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb28-141"><a href="particle-swarm-optimization-pso.html#cb28-141" aria-hidden="true" tabindex="-1"></a>      <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb28-142"><a href="particle-swarm-optimization-pso.html#cb28-142" aria-hidden="true" tabindex="-1"></a>      <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb28-143"><a href="particle-swarm-optimization-pso.html#cb28-143" aria-hidden="true" tabindex="-1"></a>      <span class="at">save_traces =</span> F <span class="co"># save more information</span></span>
<span id="cb28-144"><a href="particle-swarm-optimization-pso.html#cb28-144" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-145"><a href="particle-swarm-optimization-pso.html#cb28-145" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-146"><a href="particle-swarm-optimization-pso.html#cb28-146" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-147"><a href="particle-swarm-optimization-pso.html#cb28-147" aria-hidden="true" tabindex="-1"></a>pso_2_res<span class="sc">$</span>solution <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">as.vector</span>(<span class="fu">round</span>(pso_2_res<span class="sc">$</span>solution<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav), <span class="fu">names</span>(res_qp<span class="sc">$</span>solution))</span>
<span id="cb28-148"><a href="particle-swarm-optimization-pso.html#cb28-148" aria-hidden="true" tabindex="-1"></a>res_pso_2_fit <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(pso_2_res<span class="sc">$</span>solution) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat[<span class="fu">names</span>(pso_2_res<span class="sc">$</span>solution), <span class="fu">names</span>(pso_2_res<span class="sc">$</span>solution)] <span class="sc">%*%</span> pso_2_res<span class="sc">$</span>solution <span class="sc">-</span> <span class="fu">t</span>(<span class="fu">as.vector</span>(mat<span class="sc">$</span>dvec[<span class="fu">names</span>(pso_2_res<span class="sc">$</span>solution),])) <span class="sc">%*%</span> pso_2_res<span class="sc">$</span>solution)</span>
<span id="cb28-149"><a href="particle-swarm-optimization-pso.html#cb28-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-150"><a href="particle-swarm-optimization-pso.html#cb28-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-151"><a href="particle-swarm-optimization-pso.html#cb28-151" aria-hidden="true" tabindex="-1"></a><span class="fu">reactable</span>(</span>
<span id="cb28-152"><a href="particle-swarm-optimization-pso.html#cb28-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb28-153"><a href="particle-swarm-optimization-pso.html#cb28-153" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;solve.QP discrete&quot;</span>, <span class="st">&quot;PSO&quot;</span>, <span class="st">&quot;PSO with solve.QP as init solution&quot;</span>),</span>
<span id="cb28-154"><a href="particle-swarm-optimization-pso.html#cb28-154" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;fitness&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(res_qp_discrete_fit, res_pso_fit, res_pso_2_fit),</span>
<span id="cb28-155"><a href="particle-swarm-optimization-pso.html#cb28-155" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;sum_wgt&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(res_qp_discrete_sum_wgt, <span class="fu">sum</span>(pso_res<span class="sc">$</span>solution), <span class="fu">sum</span>(pso_2_res<span class="sc">$</span>solution)),</span>
<span id="cb28-156"><a href="particle-swarm-optimization-pso.html#cb28-156" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;time&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(time_qp[<span class="dv">3</span>], time_pso[<span class="dv">3</span>], time_pso_2[<span class="dv">3</span>])</span>
<span id="cb28-157"><a href="particle-swarm-optimization-pso.html#cb28-157" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb28-158"><a href="particle-swarm-optimization-pso.html#cb28-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">columns =</span> <span class="fu">list</span>(</span>
<span id="cb28-159"><a href="particle-swarm-optimization-pso.html#cb28-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitness =</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">digits=</span><span class="dv">9</span>)),</span>
<span id="cb28-160"><a href="particle-swarm-optimization-pso.html#cb28-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_wgt =</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">digits=</span><span class="dv">3</span>)),</span>
<span id="cb28-161"><a href="particle-swarm-optimization-pso.html#cb28-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">colDef</span>(<span class="at">format =</span> <span class="fu">colFormat</span>(<span class="at">digits=</span><span class="dv">3</span>))</span>
<span id="cb28-162"><a href="particle-swarm-optimization-pso.html#cb28-162" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-163"><a href="particle-swarm-optimization-pso.html#cb28-163" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-164"><a href="particle-swarm-optimization-pso.html#cb28-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>()</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/pso9-1.png" width="672" /></p>
<p>It can be seen that the rounded <code>solve.QP()</code> solution still has a good fitness but the constraints are not satisfied. The PSO has no constrain breaks and still reached a fitness close to the rounded <code>solve.QP()</code>. The PSO with <code>solve.QP()</code> solution as starting position has beaten both approaches. This indicates that a hybrid approach consisting of both the <code>solve.QP()</code> and afterwards the PSO for intelligent rounding with observed constraints would be a good heuristic for problems in practice.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-KeEb1995" class="csl-entry">
James Kennedy, Russell Eberhart. 1995. <span>“Particle Swarm Optimization.”</span> <a href="https://www.cs.tufts.edu/">https://www.cs.tufts.edu/</a>.
</div>
<div id="ref-PaVr2002" class="csl-entry">
Konstantinos Parsopoulos, Michael N. Vrahatis. 2002. <span>“Recent Approaches to Global Optimization Problems Through Particle Swarm Optimization.”</span>
</div>
</div>
<script src="script.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="analytic-solver-for-quadratic-programming-problems.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/AxelCode-R/Master-Thesis/edit/master/7_Simple_Particle_Swarm_Optimization.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Master_Thesis.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
