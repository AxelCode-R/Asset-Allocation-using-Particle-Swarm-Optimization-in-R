<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 PSO Variations | Asset Allocation using Particle Swarm Optimization in R</title>
  <meta name="description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.28.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 PSO Variations | Asset Allocation using Particle Swarm Optimization in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="AxelCode-R/Master-Thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 PSO Variations | Asset Allocation using Particle Swarm Optimization in R" />
  
  <meta name="twitter:description" content="This GitBook is an example of a GitBook for teaching. It can be adapted for specific courses. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Axel Roth" />


<meta name="date" content="2022-09-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="particle-swarm-optimization-pso.html"/>
<link rel="next" href="real-life-itp-example.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="my_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Master Thesis Axel Roth</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="abstract.html"><a href="abstract.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html"><i class="fa fa-check"></i><b>1</b> Software information and usage</a>
<ul>
<li class="chapter" data-level="1.1" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#r-version-and-packages"><i class="fa fa-check"></i><b>1.1</b> R-Version and Packages</a></li>
<li class="chapter" data-level="1.2" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
<li class="chapter" data-level="1.3" data-path="software-information-and-usage.html"><a href="software-information-and-usage.html#r-functions"><i class="fa fa-check"></i><b>1.3</b> R-functions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="open-data-sources.html"><a href="open-data-sources.html"><i class="fa fa-check"></i><b>2</b> Open Data Sources</a>
<ul>
<li class="chapter" data-level="2.1" data-path="open-data-sources.html"><a href="open-data-sources.html#r-functions-1"><i class="fa fa-check"></i><b>2.1</b> R-Functions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="open-data-sources.html"><a href="open-data-sources.html#get_yf"><i class="fa fa-check"></i><b>2.1.1</b> <code>get_yf()</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="open-data-sources.html"><a href="open-data-sources.html#buffer"><i class="fa fa-check"></i><b>2.1.2</b> <code>buffer()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mathfundations.html"><a href="mathfundations.html"><i class="fa fa-check"></i><b>3</b> Mathematical Fundations</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mathfundations.html"><a href="mathfundations.html#basic-operators"><i class="fa fa-check"></i><b>3.1</b> Basic Operators</a></li>
<li class="chapter" data-level="3.2" data-path="mathfundations.html"><a href="mathfundations.html#return-calculation"><i class="fa fa-check"></i><b>3.2</b> Return Calculation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mathfundations.html"><a href="mathfundations.html#simple-returns"><i class="fa fa-check"></i><b>3.2.1</b> Simple Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mathfundations.html"><a href="mathfundations.html#markowitz-modern-portfolio-theory-mpt"><i class="fa fa-check"></i><b>3.3</b> Markowitz Modern Portfolio Theory (MPT)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="mathfundations.html"><a href="mathfundations.html#assumptions-of-markowitz-portfolio-theory"><i class="fa fa-check"></i><b>3.3.1</b> Assumptions of Markowitz Portfolio Theory</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mathfundations.html"><a href="mathfundations.html#portfolio-math"><i class="fa fa-check"></i><b>3.4</b> Portfolio Math</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mathfundations.html"><a href="mathfundations.html#expected-returns"><i class="fa fa-check"></i><b>3.4.1</b> Expected Returns</a></li>
<li class="chapter" data-level="3.4.2" data-path="mathfundations.html"><a href="mathfundations.html#expected-portfolio-returns"><i class="fa fa-check"></i><b>3.4.2</b> Expected Portfolio Returns</a></li>
<li class="chapter" data-level="3.4.3" data-path="mathfundations.html"><a href="mathfundations.html#covariance"><i class="fa fa-check"></i><b>3.4.3</b> Covariance</a></li>
<li class="chapter" data-level="3.4.4" data-path="mathfundations.html"><a href="mathfundations.html#portvar"><i class="fa fa-check"></i><b>3.4.4</b> Portfolio Variance</a></li>
<li class="chapter" data-level="3.4.5" data-path="mathfundations.html"><a href="mathfundations.html#portfolioreturns"><i class="fa fa-check"></i><b>3.4.5</b> Portfolio Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="mathfundations.html"><a href="mathfundations.html#r-functions-2"><i class="fa fa-check"></i><b>3.5</b> R-Functions</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="mathfundations.html"><a href="mathfundations.html#pritoret"><i class="fa fa-check"></i><b>3.5.1</b> <code>pri_to_ret()</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="mathfundations.html"><a href="mathfundations.html#ret_to_cumret"><i class="fa fa-check"></i><b>3.5.2</b> <code>ret_to_cumret()</code></a></li>
<li class="chapter" data-level="3.5.3" data-path="mathfundations.html"><a href="mathfundations.html#geomeanret"><i class="fa fa-check"></i><b>3.5.3</b> <code>ret_to_geomeanret()</code></a></li>
<li class="chapter" data-level="3.5.4" data-path="mathfundations.html"><a href="mathfundations.html#calc_portfolio_returns"><i class="fa fa-check"></i><b>3.5.4</b> <code>calc_portfolio_returns()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="activ-vs-passiv-investing.html"><a href="activ-vs-passiv-investing.html"><i class="fa fa-check"></i><b>4</b> Activ vs Passiv Investing</a></li>
<li class="chapter" data-level="5" data-path="challenges.html"><a href="challenges.html"><i class="fa fa-check"></i><b>5</b> Challenges of Passiv Investing</a>
<ul>
<li class="chapter" data-level="5.1" data-path="challenges.html"><a href="challenges.html#mean-variance-portfolio-mvp"><i class="fa fa-check"></i><b>5.1</b> Mean-Variance Portfolio (MVP)</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="challenges.html"><a href="challenges.html#mvp-objective"><i class="fa fa-check"></i><b>5.1.1</b> MVP Objective</a></li>
<li class="chapter" data-level="5.1.2" data-path="challenges.html"><a href="challenges.html#mvp-example"><i class="fa fa-check"></i><b>5.1.2</b> MVP example</a></li>
<li class="chapter" data-level="5.1.3" data-path="challenges.html"><a href="challenges.html#mvp-compare-estimators"><i class="fa fa-check"></i><b>5.1.3</b> MVP Compare Estimators</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="challenges.html"><a href="challenges.html#index-tracking-portfolio-itp"><i class="fa fa-check"></i><b>5.2</b> Index-Tracking Portfolio (ITP)</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="challenges.html"><a href="challenges.html#itp-with-tev-objective-itp-tev"><i class="fa fa-check"></i><b>5.2.1</b> ITP with TEV objective (ITP-TEV)</a></li>
<li class="chapter" data-level="5.2.2" data-path="challenges.html"><a href="challenges.html#itp-with-mste-objective-itp-mste"><i class="fa fa-check"></i><b>5.2.2</b> ITP with MSTE objective (ITP-MSTE)</a></li>
<li class="chapter" data-level="5.2.3" data-path="challenges.html"><a href="challenges.html#example-itp"><i class="fa fa-check"></i><b>5.2.3</b> Example ITP</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html"><i class="fa fa-check"></i><b>6</b> Analytic Solver for Quadratic Programming Problems</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#quadratic-programming-qp"><i class="fa fa-check"></i><b>6.1</b> Quadratic Programming (QP)</a></li>
<li class="chapter" data-level="6.2" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#qp-solver-from-quadprog"><i class="fa fa-check"></i><b>6.2</b> QP Solver from quadprog</a></li>
<li class="chapter" data-level="6.3" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#exampleanalyticalmvp"><i class="fa fa-check"></i><b>6.3</b> Example: Solving MVP with <code>solve.QP()</code></a></li>
<li class="chapter" data-level="6.4" data-path="analytic-solver-for-quadratic-programming-problems.html"><a href="analytic-solver-for-quadratic-programming-problems.html#exampleitpsolveqp"><i class="fa fa-check"></i><b>6.4</b> Example: Solving ITP-MSTE with <code>solve.QP()</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html"><i class="fa fa-check"></i><b>7</b> Particle Swarm Optimization (PSO)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#the-algorithm"><i class="fa fa-check"></i><b>7.1</b> The Algorithm</a></li>
<li class="chapter" data-level="7.2" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#pso-function"><i class="fa fa-check"></i><b>7.2</b> <code>pso()</code> Function</a></li>
<li class="chapter" data-level="7.3" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#animation-2-dimensional"><i class="fa fa-check"></i><b>7.3</b> Animation 2-Dimensional</a></li>
<li class="chapter" data-level="7.4" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#simple-constraint-handling"><i class="fa fa-check"></i><b>7.4</b> Simple Constraint Handling</a></li>
<li class="chapter" data-level="7.5" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-mvp"><i class="fa fa-check"></i><b>7.5</b> Example MVP</a></li>
<li class="chapter" data-level="7.6" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-itp-mste"><i class="fa fa-check"></i><b>7.6</b> Example: ITP-MSTE</a></li>
<li class="chapter" data-level="7.7" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#pros-and-cons-for-continuous-problems"><i class="fa fa-check"></i><b>7.7</b> Pros and Cons for Continuous Problems</a></li>
<li class="chapter" data-level="7.8" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#discrete-problems"><i class="fa fa-check"></i><b>7.8</b> Discrete Problems</a></li>
<li class="chapter" data-level="7.9" data-path="particle-swarm-optimization-pso.html"><a href="particle-swarm-optimization-pso.html#example-discrete-itp-mste"><i class="fa fa-check"></i><b>7.9</b> Example: Discrete ITP-MSTE</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pso-variations.html"><a href="pso-variations.html"><i class="fa fa-check"></i><b>8</b> PSO Variations</a>
<ul>
<li class="chapter" data-level="8.0.1" data-path="pso-variations.html"><a href="pso-variations.html#testproblem-discrete-itp-mste"><i class="fa fa-check"></i><b>8.0.1</b> Testproblem: Discrete ITP-MSTE</a></li>
<li class="chapter" data-level="8.1" data-path="pso-variations.html"><a href="pso-variations.html#function-stretching"><i class="fa fa-check"></i><b>8.1</b> Function Stretching</a></li>
<li class="chapter" data-level="8.2" data-path="pso-variations.html"><a href="pso-variations.html#lokal-pso"><i class="fa fa-check"></i><b>8.2</b> Lokal PSO</a></li>
<li class="chapter" data-level="8.3" data-path="pso-variations.html"><a href="pso-variations.html#preserving-feasibility"><i class="fa fa-check"></i><b>8.3</b> Preserving Feasibility</a></li>
<li class="chapter" data-level="8.4" data-path="pso-variations.html"><a href="pso-variations.html#self-adaptive-velocity"><i class="fa fa-check"></i><b>8.4</b> Self-Adaptive Velocity</a></li>
<li class="chapter" data-level="8.5" data-path="pso-variations.html"><a href="pso-variations.html#test-local-and-preserving-feasibility"><i class="fa fa-check"></i><b>8.5</b> Test Local and Preserving Feasibility</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="real-life-itp-example.html"><a href="real-life-itp-example.html"><i class="fa fa-check"></i><b>9</b> Real Life ITP Example</a>
<ul>
<li class="chapter" data-level="9.1" data-path="real-life-itp-example.html"><a href="real-life-itp-example.html#transaction-costs"><i class="fa fa-check"></i><b>9.1</b> Transaction Costs</a></li>
<li class="chapter" data-level="9.2" data-path="real-life-itp-example.html"><a href="real-life-itp-example.html#rebalancing-constraint"><i class="fa fa-check"></i><b>9.2</b> Rebalancing Constraint</a></li>
<li class="chapter" data-level="9.3" data-path="real-life-itp-example.html"><a href="real-life-itp-example.html#analyse-objectives"><i class="fa fa-check"></i><b>9.3</b> Analyse Objectives</a></li>
<li class="chapter" data-level="9.4" data-path="real-life-itp-example.html"><a href="real-life-itp-example.html#complete-itp-example"><i class="fa fa-check"></i><b>9.4</b> Complete ITP Example</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>10</b> Conclusion</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/AxelCode-R/Master-Thesis" target="blank">GitHub Repository</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Asset Allocation using Particle Swarm Optimization in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pso-variations" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> PSO Variations<a href="pso-variations.html#pso-variations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The standard PSO analysed in the previews chapter is capable to solve a wide range of problems but is very slow and often gets stuck in local minima. This chapter analyses different variations of the standard PSO in finance related problems. The first variant is the PSO with functional stretching, which should reduces stagnation in local minimas. ……………</p>
<div id="testproblem-discrete-itp-mste" class="section level3 hasAnchor" number="8.0.1">
<h3><span class="header-section-number">8.0.1</span> Testproblem: Discrete ITP-MSTE<a href="pso-variations.html#testproblem-discrete-itp-mste" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All variants are tested on a discrete ITP-MSTE to track the S&amp;P 500 with a tracking portfolio consisting of the top 50 assets in the S&amp;P 500. The daily data used to solve the ITP ranges from 2018-01-01 to 2019-12-31, and the assets must be in the S&amp;P 500 at the end of the time frame and have no missing values. The top 50 assets are selected by solving a continuous ITP-MSTE using a <code>solve.QP()</code> approach and the assets with the 50 highest weights are selected. The tracking portfolio is discrete and has a net asset value of twenty thousand USD. The tracking portfolio is discretized using closing prices on 2019-12-31 and returns are calculated as simple returns from the adjusted closing prices. The maximum weighting for each asset is 10% to reduce the dimension space of the problem. Additional constraints are long only and portfolio weights <span class="math inline">\(w\)</span> should satisfy <span class="math inline">\(1 \leq \textstyle\sum w_i \geq 0.99\)</span>. All variants are run 100 times and compared to 100 runs of the standard PSO function created in the previous chapter. The swarm size for the PSO and all variations is 100 and the iterations are set to 100.</p>
<p>The next plot analyzes the behavior of the 100 standard PSO runs in each iteration by plotting the median of the best fitness achieved at each iteration. The confidence bands for the 95% and 5% quantiles of the best fitness values are plotted in the same color as the median, with less transparency:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb33-1"><a href="pso-variations.html#cb33-1" aria-hidden="true" tabindex="-1"></a>nav <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb33-2"><a href="pso-variations.html#cb33-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-3"><a href="pso-variations.html#cb33-3" aria-hidden="true" tabindex="-1"></a>from <span class="ot">&lt;-</span> <span class="st">&quot;2018-01-01&quot;</span></span>
<span id="cb33-4"><a href="pso-variations.html#cb33-4" aria-hidden="true" tabindex="-1"></a>to <span class="ot">&lt;-</span> <span class="st">&quot;2019-12-31&quot;</span></span>
<span id="cb33-5"><a href="pso-variations.html#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="pso-variations.html#cb33-6" aria-hidden="true" tabindex="-1"></a>spx_composition <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb33-7"><a href="pso-variations.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_spx_composition</span>(),</span>
<span id="cb33-8"><a href="pso-variations.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_spx_composition&quot;</span></span>
<span id="cb33-9"><a href="pso-variations.html#cb33-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-10"><a href="pso-variations.html#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="pso-variations.html#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="pso-variations.html#cb33-12" aria-hidden="true" tabindex="-1"></a>pool_data <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb33-13"><a href="pso-variations.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(</span>
<span id="cb33-14"><a href="pso-variations.html#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">tickers =</span> spx_composition <span class="sc">%&gt;%</span> </span>
<span id="cb33-15"><a href="pso-variations.html#cb33-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">&lt;=</span>to) <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="pso-variations.html#cb33-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(Date<span class="sc">==</span><span class="fu">max</span>(Date)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-17"><a href="pso-variations.html#cb33-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(Ticker), </span>
<span id="cb33-18"><a href="pso-variations.html#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> from, </span>
<span id="cb33-19"><a href="pso-variations.html#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> to</span>
<span id="cb33-20"><a href="pso-variations.html#cb33-20" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb33-21"><a href="pso-variations.html#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500_asset_data&quot;</span></span>
<span id="cb33-22"><a href="pso-variations.html#cb33-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-23"><a href="pso-variations.html#cb33-23" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>returns <span class="ot">&lt;-</span> </span>
<span id="cb33-24"><a href="pso-variations.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  pool_data<span class="sc">$</span>returns[, <span class="fu">colSums</span>(<span class="fu">is.na</span>(pool_data<span class="sc">$</span>returns))<span class="sc">==</span><span class="dv">0</span>]</span>
<span id="cb33-25"><a href="pso-variations.html#cb33-25" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>prices <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>prices[, <span class="fu">colnames</span>(pool_data<span class="sc">$</span>returns)]</span>
<span id="cb33-26"><a href="pso-variations.html#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="pso-variations.html#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="pso-variations.html#cb33-28" aria-hidden="true" tabindex="-1"></a>bm_returns <span class="ot">&lt;-</span> <span class="fu">buffer</span>(</span>
<span id="cb33-29"><a href="pso-variations.html#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_yf</span>(<span class="at">tickers =</span> <span class="st">&quot;%5EGSPC&quot;</span>, <span class="at">from =</span> from, <span class="at">to =</span> to)<span class="sc">$</span>returns, </span>
<span id="cb33-30"><a href="pso-variations.html#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;AS_sp500&quot;</span></span>
<span id="cb33-31"><a href="pso-variations.html#cb33-31" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">setNames</span>(., <span class="st">&quot;S&amp;P 500&quot;</span>)</span>
<span id="cb33-32"><a href="pso-variations.html#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="pso-variations.html#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="pso-variations.html#cb33-34" aria-hidden="true" tabindex="-1"></a>pool_returns <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>returns</span>
<span id="cb33-35"><a href="pso-variations.html#cb33-35" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-36"><a href="pso-variations.html#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> pool_returns,</span>
<span id="cb33-37"><a href="pso-variations.html#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvec =</span> <span class="fu">t</span>(pool_returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb33-38"><a href="pso-variations.html#cb33-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb33-39"><a href="pso-variations.html#cb33-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_returns)), <span class="co"># sum up to 1</span></span>
<span id="cb33-40"><a href="pso-variations.html#cb33-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb33-41"><a href="pso-variations.html#cb33-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow=</span><span class="fu">ncol</span>(pool_returns), </span>
<span id="cb33-42"><a href="pso-variations.html#cb33-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol=</span><span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb33-43"><a href="pso-variations.html#cb33-43" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb33-44"><a href="pso-variations.html#cb33-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb33-45"><a href="pso-variations.html#cb33-45" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb33-46"><a href="pso-variations.html#cb33-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_returns)) <span class="co"># long only</span></span>
<span id="cb33-47"><a href="pso-variations.html#cb33-47" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb33-48"><a href="pso-variations.html#cb33-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb33-49"><a href="pso-variations.html#cb33-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-50"><a href="pso-variations.html#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="pso-variations.html#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="co"># search 100 best tickers</span></span>
<span id="cb33-52"><a href="pso-variations.html#cb33-52" aria-hidden="true" tabindex="-1"></a>qp <span class="ot">&lt;-</span> <span class="fu">solve.QP</span>(</span>
<span id="cb33-53"><a href="pso-variations.html#cb33-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> mat<span class="sc">$</span>Dmat, <span class="at">dvec =</span> mat<span class="sc">$</span>dvec, </span>
<span id="cb33-54"><a href="pso-variations.html#cb33-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> mat<span class="sc">$</span>Amat, <span class="at">bvec =</span> mat<span class="sc">$</span>bvec, <span class="at">meq =</span> mat<span class="sc">$</span>meq</span>
<span id="cb33-55"><a href="pso-variations.html#cb33-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-56"><a href="pso-variations.html#cb33-56" aria-hidden="true" tabindex="-1"></a>sub_ticker <span class="ot">&lt;-</span> <span class="fu">colnames</span>(pool_returns)[<span class="fu">order</span>(qp<span class="sc">$</span>solution, <span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>]]</span>
<span id="cb33-57"><a href="pso-variations.html#cb33-57" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>returns <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>returns[, sub_ticker]</span>
<span id="cb33-58"><a href="pso-variations.html#cb33-58" aria-hidden="true" tabindex="-1"></a>pool_data<span class="sc">$</span>prices <span class="ot">&lt;-</span> pool_data<span class="sc">$</span>prices[, sub_ticker]</span>
<span id="cb33-59"><a href="pso-variations.html#cb33-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-60"><a href="pso-variations.html#cb33-60" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> <span class="fu">last</span>(pool_data<span class="sc">$</span>prices)</span>
<span id="cb33-61"><a href="pso-variations.html#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="pso-variations.html#cb33-62" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb33-63"><a href="pso-variations.html#cb33-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> <span class="fu">t</span>(pool_data<span class="sc">$</span>returns) <span class="sc">%*%</span> pool_data<span class="sc">$</span>returns,</span>
<span id="cb33-64"><a href="pso-variations.html#cb33-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvec =</span> <span class="fu">t</span>(pool_data<span class="sc">$</span>returns) <span class="sc">%*%</span> bm_returns,</span>
<span id="cb33-65"><a href="pso-variations.html#cb33-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amat =</span> <span class="fu">t</span>(<span class="fu">rbind</span>(</span>
<span id="cb33-66"><a href="pso-variations.html#cb33-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)), <span class="co"># sum up to 1</span></span>
<span id="cb33-67"><a href="pso-variations.html#cb33-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(<span class="dv">1</span>, </span>
<span id="cb33-68"><a href="pso-variations.html#cb33-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow=</span><span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns), </span>
<span id="cb33-69"><a href="pso-variations.html#cb33-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol=</span><span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)) <span class="co"># long only</span></span>
<span id="cb33-70"><a href="pso-variations.html#cb33-70" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb33-71"><a href="pso-variations.html#cb33-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">bvec =</span> <span class="fu">c</span>(</span>
<span id="cb33-72"><a href="pso-variations.html#cb33-72" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="co"># sum up to 1</span></span>
<span id="cb33-73"><a href="pso-variations.html#cb33-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)) <span class="co"># long only</span></span>
<span id="cb33-74"><a href="pso-variations.html#cb33-74" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb33-75"><a href="pso-variations.html#cb33-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">meq =</span> <span class="dv">1</span></span>
<span id="cb33-76"><a href="pso-variations.html#cb33-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-77"><a href="pso-variations.html#cb33-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-78"><a href="pso-variations.html#cb33-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-79"><a href="pso-variations.html#cb33-79" aria-hidden="true" tabindex="-1"></a>calc_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb33-80"><a href="pso-variations.html#cb33-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> mat<span class="sc">$</span>Dmat <span class="sc">%*%</span> x <span class="sc">-</span> <span class="fu">t</span>(mat<span class="sc">$</span>dvec) <span class="sc">%*%</span> x)</span>
<span id="cb33-81"><a href="pso-variations.html#cb33-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-82"><a href="pso-variations.html#cb33-82" aria-hidden="true" tabindex="-1"></a>calc_const <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb33-83"><a href="pso-variations.html#cb33-83" aria-hidden="true" tabindex="-1"></a>  const <span class="ot">&lt;-</span> <span class="fu">t</span>(mat<span class="sc">$</span>Amat) <span class="sc">%*%</span> x <span class="sc">-</span> mat<span class="sc">$</span>bvec</span>
<span id="cb33-84"><a href="pso-variations.html#cb33-84" aria-hidden="true" tabindex="-1"></a>  const[mat<span class="sc">$</span>meq] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">pmax</span>(<span class="dv">0</span>, <span class="fu">abs</span>(const[mat<span class="sc">$</span>meq]<span class="sc">+</span><span class="fl">0.005</span>)<span class="sc">-</span><span class="fl">0.005</span>)</span>
<span id="cb33-85"><a href="pso-variations.html#cb33-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">pmin</span>(<span class="dv">0</span>, const)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb33-86"><a href="pso-variations.html#cb33-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-87"><a href="pso-variations.html#cb33-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-88"><a href="pso-variations.html#cb33-88" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb33-89"><a href="pso-variations.html#cb33-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-90"><a href="pso-variations.html#cb33-90" aria-hidden="true" tabindex="-1"></a>df_SPSO <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb33-91"><a href="pso-variations.html#cb33-91" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb33-92"><a href="pso-variations.html#cb33-92" aria-hidden="true" tabindex="-1"></a>  res_SPSO_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb33-93"><a href="pso-variations.html#cb33-93" aria-hidden="true" tabindex="-1"></a>    res_SPSO <span class="ot">&lt;-</span> <span class="fu">pso</span>(</span>
<span id="cb33-94"><a href="pso-variations.html#cb33-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)),</span>
<span id="cb33-95"><a href="pso-variations.html#cb33-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb33-96"><a href="pso-variations.html#cb33-96" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">round</span>(x<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav)</span>
<span id="cb33-97"><a href="pso-variations.html#cb33-97" aria-hidden="true" tabindex="-1"></a>        fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb33-98"><a href="pso-variations.html#cb33-98" aria-hidden="true" tabindex="-1"></a>        constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb33-99"><a href="pso-variations.html#cb33-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(fitness<span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb33-100"><a href="pso-variations.html#cb33-100" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb33-101"><a href="pso-variations.html#cb33-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb33-102"><a href="pso-variations.html#cb33-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="fl">0.1</span>,</span>
<span id="cb33-103"><a href="pso-variations.html#cb33-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb33-104"><a href="pso-variations.html#cb33-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> <span class="dv">100</span>, <span class="co"># swarm size</span></span>
<span id="cb33-105"><a href="pso-variations.html#cb33-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb33-106"><a href="pso-variations.html#cb33-106" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb33-107"><a href="pso-variations.html#cb33-107" aria-hidden="true" tabindex="-1"></a>        <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb33-108"><a href="pso-variations.html#cb33-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb33-109"><a href="pso-variations.html#cb33-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb33-110"><a href="pso-variations.html#cb33-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">save_fit =</span> T <span class="co"># save more information</span></span>
<span id="cb33-111"><a href="pso-variations.html#cb33-111" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-112"><a href="pso-variations.html#cb33-112" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-113"><a href="pso-variations.html#cb33-113" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb33-114"><a href="pso-variations.html#cb33-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-115"><a href="pso-variations.html#cb33-115" aria-hidden="true" tabindex="-1"></a>  df_SPSO <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_SPSO, </span>
<span id="cb33-116"><a href="pso-variations.html#cb33-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb33-117"><a href="pso-variations.html#cb33-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;run&quot;</span> <span class="ot">=</span> i,</span>
<span id="cb33-118"><a href="pso-variations.html#cb33-118" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">rbind</span>(<span class="fu">data.frame</span>(</span>
<span id="cb33-119"><a href="pso-variations.html#cb33-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="st">&quot;PSO&quot;</span>, <span class="st">&quot;time&quot;</span><span class="ot">=</span>res_SPSO_time[<span class="dv">3</span>], <span class="st">&quot;const_break&quot;</span><span class="ot">=</span><span class="fu">calc_const</span>(res_SPSO<span class="sc">$</span>solution), res_SPSO<span class="sc">$</span>fit_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(iter, <span class="st">&quot;mean_fit&quot;</span><span class="ot">=</span>mean, <span class="st">&quot;best_fit&quot;</span><span class="ot">=</span>best)</span>
<span id="cb33-120"><a href="pso-variations.html#cb33-120" aria-hidden="true" tabindex="-1"></a>      )))</span>
<span id="cb33-121"><a href="pso-variations.html#cb33-121" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-122"><a href="pso-variations.html#cb33-122" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-123"><a href="pso-variations.html#cb33-123" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-124"><a href="pso-variations.html#cb33-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-125"><a href="pso-variations.html#cb33-125" aria-hidden="true" tabindex="-1"></a>df_res <span class="ot">&lt;-</span> df_SPSO <span class="sc">%&gt;%</span> </span>
<span id="cb33-126"><a href="pso-variations.html#cb33-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, type) <span class="sc">%&gt;%</span> </span>
<span id="cb33-127"><a href="pso-variations.html#cb33-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">time_mean=</span><span class="fu">mean</span>(time), <span class="at">const_break_mean=</span><span class="fu">mean</span>(const_break), <span class="at">best_fit_q1 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.05</span>), <span class="at">best_fit_q3 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.95</span>), <span class="at">best_fit_mean =</span> <span class="fu">mean</span>(best_fit), <span class="at">best_fit_median =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-128"><a href="pso-variations.html#cb33-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb33-129"><a href="pso-variations.html#cb33-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-130"><a href="pso-variations.html#cb33-130" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-131"><a href="pso-variations.html#cb33-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res, <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_median, <span class="at">name =</span> <span class="st">&quot;PSO&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 1)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-132"><a href="pso-variations.html#cb33-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res, <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q1, <span class="at">name =</span> <span class="st">&quot;PSO_q1&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb33-133"><a href="pso-variations.html#cb33-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res, <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q3, <span class="at">name =</span> <span class="st">&quot;PSO_q3&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">fill=</span><span class="st">&quot;tonexty&quot;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">fillcolor =</span> <span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>, <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb33-134"><a href="pso-variations.html#cb33-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="fu">min</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">3</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">-</span><span class="fl">0.001</span>,  <span class="fu">max</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">3</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">+</span><span class="fl">0.001</span>), <span class="at">title=</span><span class="st">&quot;best fitness&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-135"><a href="pso-variations.html#cb33-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>()</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-8-1.png" width="672" />
The aggregate statistics of the last iterations of all 100 runs can be found in the table below:</p>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="function-stretching" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Function Stretching<a href="pso-variations.html#function-stretching" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>(Recent_approaches_to_global_optimization_problems_.pdf)</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb34-1"><a href="pso-variations.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb34-2"><a href="pso-variations.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R/PSO_functions.R : pso_fn_stretching()</span></span>
<span id="cb34-3"><a href="pso-variations.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="pso-variations.html#cb34-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-5"><a href="pso-variations.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb34-6"><a href="pso-variations.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  res_pso_fns_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb34-7"><a href="pso-variations.html#cb34-7" aria-hidden="true" tabindex="-1"></a>    res_pso_fns <span class="ot">&lt;-</span> <span class="fu">pso_fn_stretching</span>(</span>
<span id="cb34-8"><a href="pso-variations.html#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)),</span>
<span id="cb34-9"><a href="pso-variations.html#cb34-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb34-10"><a href="pso-variations.html#cb34-10" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">round</span>(x<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav)</span>
<span id="cb34-11"><a href="pso-variations.html#cb34-11" aria-hidden="true" tabindex="-1"></a>        fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb34-12"><a href="pso-variations.html#cb34-12" aria-hidden="true" tabindex="-1"></a>        constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb34-13"><a href="pso-variations.html#cb34-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(fitness<span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb34-14"><a href="pso-variations.html#cb34-14" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb34-15"><a href="pso-variations.html#cb34-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb34-16"><a href="pso-variations.html#cb34-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="fl">0.1</span>,</span>
<span id="cb34-17"><a href="pso-variations.html#cb34-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb34-18"><a href="pso-variations.html#cb34-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> <span class="dv">100</span>, <span class="co"># swarm size</span></span>
<span id="cb34-19"><a href="pso-variations.html#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb34-20"><a href="pso-variations.html#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb34-21"><a href="pso-variations.html#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb34-22"><a href="pso-variations.html#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb34-23"><a href="pso-variations.html#cb34-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb34-24"><a href="pso-variations.html#cb34-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">fn_stretching =</span> T,</span>
<span id="cb34-25"><a href="pso-variations.html#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">save_fit =</span> T</span>
<span id="cb34-26"><a href="pso-variations.html#cb34-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-27"><a href="pso-variations.html#cb34-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-28"><a href="pso-variations.html#cb34-28" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb34-29"><a href="pso-variations.html#cb34-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-30"><a href="pso-variations.html#cb34-30" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, </span>
<span id="cb34-31"><a href="pso-variations.html#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb34-32"><a href="pso-variations.html#cb34-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;run&quot;</span> <span class="ot">=</span> i,</span>
<span id="cb34-33"><a href="pso-variations.html#cb34-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">data.frame</span>(</span>
<span id="cb34-34"><a href="pso-variations.html#cb34-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="st">&quot;PSO-fnS&quot;</span>, <span class="st">&quot;time&quot;</span><span class="ot">=</span>res_pso_fns_time[<span class="dv">3</span>], <span class="st">&quot;const_break&quot;</span><span class="ot">=</span><span class="fu">calc_const</span>(res_pso_fns<span class="sc">$</span>solution), res_pso_fns<span class="sc">$</span>trace_fit <span class="sc">%&gt;%</span> <span class="fu">select</span>(iter, mean_fit, best_fit)</span>
<span id="cb34-35"><a href="pso-variations.html#cb34-35" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb34-36"><a href="pso-variations.html#cb34-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-37"><a href="pso-variations.html#cb34-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-38"><a href="pso-variations.html#cb34-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-39"><a href="pso-variations.html#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="pso-variations.html#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="pso-variations.html#cb34-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-42"><a href="pso-variations.html#cb34-42" aria-hidden="true" tabindex="-1"></a>df_res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_SPSO, df) <span class="sc">%&gt;%</span> </span>
<span id="cb34-43"><a href="pso-variations.html#cb34-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(best_fit = best_fit +1) %&gt;% </span></span>
<span id="cb34-44"><a href="pso-variations.html#cb34-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, type) <span class="sc">%&gt;%</span> </span>
<span id="cb34-45"><a href="pso-variations.html#cb34-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">time_mean=</span><span class="fu">mean</span>(time), <span class="at">const_break_mean=</span><span class="fu">mean</span>(const_break), <span class="at">best_fit_q1 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.05</span>), <span class="at">best_fit_q3 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.95</span>), <span class="at">best_fit_mean =</span> <span class="fu">mean</span>(best_fit), <span class="at">best_fit_median =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-46"><a href="pso-variations.html#cb34-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-47"><a href="pso-variations.html#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="pso-variations.html#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="pso-variations.html#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-50"><a href="pso-variations.html#cb34-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_median, <span class="at">name =</span> <span class="st">&quot;PSO&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 1)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-51"><a href="pso-variations.html#cb34-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q1, <span class="at">name =</span> <span class="st">&quot;PSO_q1&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-52"><a href="pso-variations.html#cb34-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q3, <span class="at">name =</span> <span class="st">&quot;PSO_q3&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">fill=</span><span class="st">&quot;tonexty&quot;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">fillcolor =</span> <span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>, <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-53"><a href="pso-variations.html#cb34-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-fnS&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_median, <span class="at">name =</span> <span class="st">&quot;PSO-fnS&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>,<span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 1)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-54"><a href="pso-variations.html#cb34-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-fnS&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q1, <span class="at">name =</span> <span class="st">&quot;PSO-fnS_q1&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>), <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-55"><a href="pso-variations.html#cb34-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-fnS&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q3, <span class="at">name =</span> <span class="st">&quot;PSO-fnS_q3&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">fill=</span><span class="st">&quot;tonexty&quot;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>), <span class="at">fillcolor =</span> <span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>, <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb34-56"><a href="pso-variations.html#cb34-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="fu">min</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">3</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">-</span><span class="fl">0.001</span>,  <span class="fu">max</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">3</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">+</span><span class="fl">0.001</span>), <span class="at">title=</span><span class="st">&quot;best fitness&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-57"><a href="pso-variations.html#cb34-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>()</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-10-1.png" width="672" />
The aggregated statistics of the last iterations of all 100 runs can be found in the table below:</p>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>10.1.1.301.4441.pdf
function stretching</p>
<p>Boudt-Wan2020_Article_TheEffectOfVelocitySparsityOnT
SV-PSO CV-PSO
oh ist nur binary PSO</p>
<p>pso_cardinality_constrained.pdf</p>
<p>DissertationHelwig (1).pdf</p>
</div>
<div id="lokal-pso" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Lokal PSO<a href="pso-variations.html#lokal-pso" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>neightborhood
Particle_Swarm_Optimization_Global_Best_or_Local_Best.pdf</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code_fold_it_collapsed"><code class="sourceCode r"><span id="cb35-1"><a href="pso-variations.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb35-2"><a href="pso-variations.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># R/PSO_functions.R : pso_local()</span></span>
<span id="cb35-3"><a href="pso-variations.html#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="pso-variations.html#cb35-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb35-5"><a href="pso-variations.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>){</span>
<span id="cb35-6"><a href="pso-variations.html#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="pso-variations.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  res_pso_local_time <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb35-8"><a href="pso-variations.html#cb35-8" aria-hidden="true" tabindex="-1"></a>    res_pso_local <span class="ot">&lt;-</span> <span class="fu">pso_local</span>(</span>
<span id="cb35-9"><a href="pso-variations.html#cb35-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">par =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(pool_data<span class="sc">$</span>returns)),</span>
<span id="cb35-10"><a href="pso-variations.html#cb35-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">fn =</span> <span class="cf">function</span>(x){</span>
<span id="cb35-11"><a href="pso-variations.html#cb35-11" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">round</span>(x<span class="sc">*</span>nav<span class="sc">/</span>prices)<span class="sc">*</span>prices<span class="sc">/</span>nav)</span>
<span id="cb35-12"><a href="pso-variations.html#cb35-12" aria-hidden="true" tabindex="-1"></a>        fitness <span class="ot">&lt;-</span> <span class="fu">calc_fit</span>(x)</span>
<span id="cb35-13"><a href="pso-variations.html#cb35-13" aria-hidden="true" tabindex="-1"></a>        constraints <span class="ot">&lt;-</span> <span class="fu">calc_const</span>(x)</span>
<span id="cb35-14"><a href="pso-variations.html#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(fitness<span class="sc">+</span><span class="dv">10</span><span class="sc">*</span>constraints)</span>
<span id="cb35-15"><a href="pso-variations.html#cb35-15" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb35-16"><a href="pso-variations.html#cb35-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb35-17"><a href="pso-variations.html#cb35-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-18"><a href="pso-variations.html#cb35-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(</span>
<span id="cb35-19"><a href="pso-variations.html#cb35-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">s =</span> <span class="dv">100</span>, <span class="co"># swarm size</span></span>
<span id="cb35-20"><a href="pso-variations.html#cb35-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.p =</span> <span class="fl">0.5</span>, <span class="co"># inherit best</span></span>
<span id="cb35-21"><a href="pso-variations.html#cb35-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">c.g =</span> <span class="fl">0.5</span>, <span class="co"># global best</span></span>
<span id="cb35-22"><a href="pso-variations.html#cb35-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">maxiter =</span> <span class="dv">100</span>, <span class="co"># iterations</span></span>
<span id="cb35-23"><a href="pso-variations.html#cb35-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">w0 =</span> <span class="fl">1.2</span>, <span class="co"># starting inertia weight</span></span>
<span id="cb35-24"><a href="pso-variations.html#cb35-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">wN =</span> <span class="dv">0</span>, <span class="co"># ending inertia weight</span></span>
<span id="cb35-25"><a href="pso-variations.html#cb35-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">save_fit =</span> T,</span>
<span id="cb35-26"><a href="pso-variations.html#cb35-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">k=</span><span class="dv">20</span></span>
<span id="cb35-27"><a href="pso-variations.html#cb35-27" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb35-28"><a href="pso-variations.html#cb35-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-29"><a href="pso-variations.html#cb35-29" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-30"><a href="pso-variations.html#cb35-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-31"><a href="pso-variations.html#cb35-31" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df, </span>
<span id="cb35-32"><a href="pso-variations.html#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb35-33"><a href="pso-variations.html#cb35-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;run&quot;</span> <span class="ot">=</span> i,</span>
<span id="cb35-34"><a href="pso-variations.html#cb35-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">suppressWarnings</span>(<span class="fu">data.frame</span>(</span>
<span id="cb35-35"><a href="pso-variations.html#cb35-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="st">&quot;PSO-local&quot;</span>, <span class="st">&quot;time&quot;</span><span class="ot">=</span>res_pso_local_time[<span class="dv">3</span>], <span class="st">&quot;const_break&quot;</span><span class="ot">=</span><span class="fu">calc_const</span>(res_pso_local<span class="sc">$</span>solution), res_pso_local<span class="sc">$</span>fit_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(iter, <span class="st">&quot;mean_fit&quot;</span><span class="ot">=</span>mean, <span class="st">&quot;best_fit&quot;</span> <span class="ot">=</span> best)</span>
<span id="cb35-36"><a href="pso-variations.html#cb35-36" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb35-37"><a href="pso-variations.html#cb35-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-38"><a href="pso-variations.html#cb35-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-39"><a href="pso-variations.html#cb35-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-40"><a href="pso-variations.html#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="pso-variations.html#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="pso-variations.html#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="pso-variations.html#cb35-43" aria-hidden="true" tabindex="-1"></a>df_res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_SPSO, df) <span class="sc">%&gt;%</span> </span>
<span id="cb35-44"><a href="pso-variations.html#cb35-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(best_fit = best_fit +1) %&gt;% </span></span>
<span id="cb35-45"><a href="pso-variations.html#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, type) <span class="sc">%&gt;%</span> </span>
<span id="cb35-46"><a href="pso-variations.html#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">time_mean=</span><span class="fu">mean</span>(time), <span class="at">const_break_mean=</span><span class="fu">mean</span>(const_break), <span class="at">best_fit_q1 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.05</span>), <span class="at">best_fit_q3 =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.95</span>), <span class="at">best_fit_mean =</span> <span class="fu">mean</span>(best_fit), <span class="at">best_fit_median =</span> <span class="fu">quantile</span>(best_fit, <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-47"><a href="pso-variations.html#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb35-48"><a href="pso-variations.html#cb35-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-49"><a href="pso-variations.html#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-50"><a href="pso-variations.html#cb35-50" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-51"><a href="pso-variations.html#cb35-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_median, <span class="at">name =</span> <span class="st">&quot;PSO&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 1)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-52"><a href="pso-variations.html#cb35-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q1, <span class="at">name =</span> <span class="st">&quot;PSO_q1&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-53"><a href="pso-variations.html#cb35-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q3, <span class="at">name =</span> <span class="st">&quot;PSO_q3&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">fill=</span><span class="st">&quot;tonexty&quot;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>), <span class="at">fillcolor =</span> <span class="st">&quot;rgba(255, 51, 0, 0.4)&quot;</span>, <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-54"><a href="pso-variations.html#cb35-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-local&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_median, <span class="at">name =</span> <span class="st">&quot;PSO-local&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>,<span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 1)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-55"><a href="pso-variations.html#cb35-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-local&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q1, <span class="at">name =</span> <span class="st">&quot;PSO-local_q1&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>), <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-56"><a href="pso-variations.html#cb35-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> df_res <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">&quot;PSO-local&quot;</span>), <span class="at">x=</span><span class="sc">~</span>iter, <span class="at">y=</span><span class="sc">~</span>best_fit_q3, <span class="at">name =</span> <span class="st">&quot;PSO-local_q3&quot;</span>, <span class="at">mode=</span><span class="st">&quot;lines&quot;</span>, <span class="at">type =</span> <span class="st">&#39;scatter&#39;</span>, <span class="at">fill=</span><span class="st">&quot;tonexty&quot;</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color=</span><span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>), <span class="at">fillcolor =</span> <span class="st">&quot;rgba(0, 102, 204, 0.3)&quot;</span>, <span class="at">showlegend=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb35-57"><a href="pso-variations.html#cb35-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">yaxis=</span><span class="fu">list</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="fu">min</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">7</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">-</span><span class="fl">0.001</span>,  <span class="fu">max</span>(df_res[df_res<span class="sc">$</span>iter<span class="sc">&gt;</span><span class="dv">7</span>,]<span class="sc">$</span>best_fit_q3)<span class="sc">+</span><span class="fl">0.001</span>), <span class="at">title=</span><span class="st">&quot;best fitness&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-58"><a href="pso-variations.html#cb35-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_save</span>()</span></code></pre></div>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-12-1.png" width="672" />
The aggregated statistics of the last iterations of all 100 runs can be found in the table below:</p>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="preserving-feasibility" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Preserving Feasibility<a href="pso-variations.html#preserving-feasibility" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>SCI2002Constrained.pdf</p>
</div>
<div id="self-adaptive-velocity" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Self-Adaptive Velocity<a href="pso-variations.html#self-adaptive-velocity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="test-local-and-preserving-feasibility" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Test Local and Preserving Feasibility<a href="pso-variations.html#test-local-and-preserving-feasibility" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="Master_Thesis_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>

</div>
</div>
<script src="script.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="particle-swarm-optimization-pso.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="real-life-itp-example.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/AxelCode-R/Master-Thesis/edit/master/8_PSO_Variations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Master_Thesis.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
